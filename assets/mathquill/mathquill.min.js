/**
 * MathQuill v0.10.1, by Han, Jeanine, and Mary
 * http://mathquill.com | maintainers@mathquill.com
 *
 * This Source Code Form is subject to the terms of the
 * Mozilla Public License, v. 2.0. If a copy of the MPL
 * was not distributed with this file, You can obtain
 * one at http://mozilla.org/MPL/2.0/.
 */
!function(){function t(){}function e(t){var e=t.length-1;return function(){var n=g.call(arguments,0,e),i=g.call(arguments,e);return t.apply(this,n.concat([i]))}}function n(t){return e(function(e,n){"function"!=typeof e&&(e=b(e));var i=function(t){return e.apply(t,[t].concat(n))};return t.call(this,i)})}function i(t){var e=g.call(arguments,1);return function(){return t.apply(this,e)}}function s(t,e){if(!e)throw new Error("prayer failed: "+t)}function r(t){s("a direction was passed",t===w||t===y)}function o(t,e,n){s("a parent is always present",t),s("leftward is properly set up",function(){return e?e[y]===n&&e.parent===t:t.ends[w]===n}()),s("rightward is properly set up",function(){return n?n[w]===e&&n.parent===t:t.ends[y]===e}())}function a(){window.console&&console.warn('You are using the MathQuill API without specifying an interface version, which will fail in v1.0.0. Easiest fix is to do the following before doing anything else:\n\n    MathQuill = MathQuill.getInterface(1);\n    // now MathQuill.MathField() works like it used to\n\nSee also the "`dev` branch (2014–2015) → v0.10.0 Migration Guide" at\n  https://github.com/mathquill/mathquill/wiki/%60dev%60-branch-(2014%E2%80%932015)-%E2%86%92-v0.10.0-Migration-Guide')}function l(t){return a(),Bt(t)}function c(e){function n(t){var e,n;return t&&t.nodeType?(e=x(t).children(".mq-root-block").attr(Ft),n=e&&k.byId[e].controller,n?s[n.KIND_OF_MQ](n):null):null}function i(t,e){var n,i,r;e&&e.handlers&&(e.handlers={fns:e.handlers,APIClasses:s});for(n in e)e.hasOwnProperty(n)&&(i=e[n],r=E[n],t[n]=r?r(i):i)}var s,r,o;if(!(R<=e&&e<=B))throw"Only interface versions between "+R+" and "+B+" supported. You specified: "+e;s={},n.L=w,n.R=y,n.saneKeyboardEvents=M,n.config=function(t){return i(_.p,t),this},n.registerEmbed=function(t,e){if(!/^[a-z][a-z0-9]*$/i.test(t))throw"Embed name must start with letter and be only letters and digits";L[t]=e},r=s.AbstractMathQuill=v(A,function(t){t.init=function(t){this.__controller=t,this.__options=t.options,this.id=t.id,this.data=t.data},t.__mathquillify=function(t){var e,n=this.__controller,i=n.root,s=n.container;n.createTextarea(),e=s.addClass(t).contents().detach(),i.jQ=x('<span class="mq-root-block"/>').attr(Ft,i.id).appendTo(s),this.latex(e.text()),this.revert=function(){return s.empty().unbind(".mathquill").removeClass("mq-editable-field mq-math-mode mq-text-mode").append(e)}},t.config=function(t){return i(this.__options,t),this},t.el=function(){return this.__controller.container[0]},t.text=function(){return this.__controller.exportText()},t.latex=function(t){return arguments.length>0?(this.__controller.renderLatexMath(t),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this):this.__controller.exportLatex()},t.html=function(){return this.__controller.root.jQ.html().replace(/ mathquill-(?:command|block)-id="?\d+"?/g,"").replace(/<span class="?mq-cursor( mq-blink)?"?>.?<\/span>/i,"").replace(/ mq-hasCursor|mq-hasCursor ?/,"").replace(/ class=(""|(?= |>))/g,"")},t.reflow=function(){return this.__controller.root.postOrder("reflow"),this}}),n.prototype=r.prototype,s.EditableField=v(r,function(e,n){e.__mathquillify=function(){return n.__mathquillify.apply(this,arguments),this.__controller.editable=!0,this.__controller.delegateMouseEvents(),this.__controller.editablesTextareaEvents(),this},e.focus=function(){return this.__controller.textarea.focus(),this},e.blur=function(){return this.__controller.textarea.blur(),this},e.write=function(t){return this.__controller.writeLatex(t),this.__controller.scrollHoriz(),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this},e.empty=function(){var t=this.__controller.root,e=this.__controller.cursor;return t.eachChild("postOrder","dispose"),t.ends[w]=t.ends[y]=0,t.jQ.empty(),delete e.selection,e.insAtRightEnd(t),this},e.cmd=function(t){var e,n=this.__controller.notify(),i=n.cursor;return/^\\[a-z]+$/i.test(t)&&!i.isTooDeep()?(t=t.slice(1),(e=T[t]||bt[latex])&&(t=e(t),i.selection&&t.replaces(i.replaceSelection()),t.createLeftOf(i.show()),this.__controller.scrollHoriz())):i.parent.write(i,t),n.blurred&&i.hide().parent.blur(),this},e.select=function(){var t=this.__controller;for(t.notify("move").cursor.insAtRightEnd(t.root);t.cursor[w];)t.selectLeft();return this},e.clearSelection=function(){return this.__controller.cursor.clearSelection(),this},e.moveToDirEnd=function(t){return this.__controller.notify("move").cursor.insAtDirEnd(t,this.__controller.root),this},e.moveToLeftEnd=function(){return this.moveToDirEnd(w)},e.moveToRightEnd=function(){return this.moveToDirEnd(y)},e.keystroke=function(e){var n;for(e=e.replace(/^\s+|\s+$/g,"").split(/\s+/),n=0;n<e.length;n+=1)this.__controller.keystroke(e[n],{preventDefault:t});return this},e.typedText=function(t){for(var e=0;e<t.length;e+=1)this.__controller.typedText(t.charAt(e));return this},e.dropEmbedded=function(t,e,n){var i,s=t-x(window).scrollLeft(),r=e-x(window).scrollTop(),o=document.elementFromPoint(s,r);this.__controller.seek(x(o),t,e),i=gt().setOptions(n),i.createLeftOf(this.__controller.cursor)},e.clickAt=function(t,e,n){n=n||document.elementFromPoint(t,e);var i=this.__controller,s=i.root;return Mt.contains(s.jQ[0],n)||(n=s.jQ[0]),i.seek(x(n),t+pageXOffset,e+pageYOffset),i.blurred&&this.focus(),this},e.ignoreNextMousedown=function(t){return this.__controller.cursor.options.ignoreNextMousedown=t,this}}),n.EditableField=function(){throw"wtf don't call me, I'm 'abstract'"},n.EditableField.prototype=s.EditableField.prototype;for(o in S)!function(t,i){var r=s[t]=i(s);n[t]=function(i,s){var o,a=n(i);return a instanceof r||!i||!i.nodeType?a:(o=D(r.RootBlock(),x(i),_()),o.KIND_OF_MQ=t,r(o).__mathquillify(s,e))},n[t].prototype=r.prototype}(o,S[o]);return n}function u(t){var e,n="moveOutOf deleteOutOf selectOutOf upOutOf downOutOf".split(" ");for(e=0;e<n.length;e+=1)!function(e){t[e]=function(t){this.controller.handle(e,t)}}(n[e]);t.reflow=function(){this.controller.handle("reflow"),this.controller.handle("edited"),this.controller.handle("edit")}}function h(t,e,n){return v(V,{ctrlSeq:t,htmlTemplate:"<"+e+" "+n+">&0</"+e+">"})}function p(t){var e=this.parent,n=t;do{if(n[y])return t.insLeftOf(e);n=n.parent.parent}while(n!==e);t.insRightOf(e)}function f(t,e){t.jQadd=function(){e.jQadd.apply(this,arguments),this.delimjQs=this.jQ.children(":first").add(this.jQ.children(":last")),this.contentjQ=this.jQ.children(":eq(1)")},t.reflow=function(){var t=this.contentjQ.outerHeight()/parseFloat(this.contentjQ.css("fontSize"));Z(this.delimjQs,Pt(1+.2*(t-1),1.2),1.2*t)}}function d(t,e){var e=e||t,n=dt[t],s=dt[e];j[t]=i(ft,w,t,n,e,s),j[n]=i(ft,y,t,n,e,s)}var m,g,b,v,w,y,x,q,k,O,T,j,C,Q,D,S,_,E,A,L,R,B,I,M,z,F,P,$,X,N,H,W,U,V,Y,G,K,Z,J,tt,et,nt,it,st,rt,ot,at,lt,ct,ut,ht,pt,ft,dt,mt,gt,bt,vt,wt,yt,xt,qt,kt,Ot,Tt,jt,Ct,Qt,Dt,St,_t,Et,At,Lt,Rt,Bt,It,Mt=window.jQuery,zt="mathquill-command-id",Ft="mathquill-block-id",Pt=Math.min,$t=Math.max;if(!Mt)throw"MathQuill requires jQuery 1.5.2+ to be loaded first";g=[].slice,b=e(function(t,n){return e(function(e,i){if(t in e)return e[t].apply(e,n.concat(i))})}),v=function(t,e,n){function i(t){return"object"==typeof t}function s(t){return"function"==typeof t}function r(){}return function t(n,o){function a(){var t=new l;return s(t.init)&&t.init.apply(t,arguments),t}function l(){}var c,u,h;return void 0===o&&(o=n,n=Object),a.Bare=l,c=r.prototype=n.prototype,u=l.prototype=a.prototype=a.p=new r,u.constructor=a,a.extend=function(e){return t(a,e)},(a.open=function(t){if(h={},s(t)?h=t.call(a,u,c,a,n):i(t)&&(h=t),i(h))for(var r in h)e.call(h,r)&&(u[r]=h[r]);return s(u.init)||(u.init=n),a})(o)}}(0,{}.hasOwnProperty),w=-1,y=1,x=v(Mt,function(t){t.insDirOf=function(t,e){return t===w?this.insertBefore(e.first()):this.insertAfter(e.last())},t.insAtDirEnd=function(t,e){return t===w?this.prependTo(e):this.appendTo(e)}}),q=v(function(t){t.parent=0,t[w]=0,t[y]=0,t.init=function(t,e,n){this.parent=t,this[w]=e,this[y]=n},this.copy=function(t){return q(t.parent,t[w],t[y])}}),k=v(function(t){function e(){return i+=1}t[w]=0,t[y]=0,t.parent=0;var i=0;this.byId={},t.init=function(){this.id=e(),k.byId[this.id]=this,this.ends={},this.ends[w]=0,this.ends[y]=0},t.dispose=function(){delete k.byId[this.id]},t.toString=function(){return"{{ MathQuill Node #"+this.id+" }}"},t.jQ=x(),t.jQadd=function(t){return this.jQ=this.jQ.add(t)},t.jQize=function(t){function e(t){var n,i;for(t.getAttribute&&(n=t.getAttribute("mathquill-command-id"),i=t.getAttribute("mathquill-block-id"),n&&k.byId[n].jQadd(t),i&&k.byId[i].jQadd(t)),t=t.firstChild;t;t=t.nextSibling)e(t)}var n;for(t=x(t||this.html()),n=0;n<t.length;n+=1)e(t[n]);return t},t.createDir=function(t,e){r(t);var n=this;return n.jQize(),n.jQ.insDirOf(t,e.jQ),e[t]=n.adopt(e.parent,e[w],e[y]),n},t.createLeftOf=function(t){return this.createDir(w,t)},t.selectChildren=function(t,e){return Q(t,e)},t.bubble=n(function(t){var e;for(e=this;e&&!1!==t(e);e=e.parent);return this}),t.postOrder=n(function(t){return function e(n){n.eachChild(e),t(n)}(this),this}),t.isEmpty=function(){return 0===this.ends[w]&&0===this.ends[y]},t.isStyleBlock=function(){return!1},t.children=function(){return O(this.ends[w],this.ends[y])},t.eachChild=function(){var t=this.children();return t.each.apply(t,arguments),this},t.foldChildren=function(t,e){return this.children().fold(t,e)},t.withDirAdopt=function(t,e,n,i){return O(this,this).withDirAdopt(t,e,n,i),this},t.adopt=function(t,e,n){return O(this,this).adopt(t,e,n),this},t.disown=function(){return O(this,this).disown(),this},t.remove=function(){return this.jQ.remove(),this.postOrder("dispose"),this.disown()}}),O=v(function(t){t.init=function(t,e,n){if(n===m&&(n=w),r(n),s("no half-empty fragments",!t==!e),this.ends={},t){s("withDir is passed to Fragment",t instanceof k),s("oppDir is passed to Fragment",e instanceof k),s("withDir and oppDir have the same parent",t.parent===e.parent),this.ends[n]=t,this.ends[-n]=e;var i=this.fold([],function(t,e){return t.push.apply(t,e.jQ.get()),t});this.jQ=this.jQ.add(i)}},t.jQ=x(),t.withDirAdopt=function(t,e,n,i){return t===w?this.adopt(e,n,i):this.adopt(e,i,n)},t.adopt=function(t,e,n){var i,s,r;return o(t,e,n),i=this,i.disowned=!1,(s=i.ends[w])?(r=i.ends[y],e||(t.ends[w]=s),n?n[w]=r:t.ends[y]=r,i.ends[y][y]=n,i.each(function(n){n[w]=e,n.parent=t,e&&(e[y]=n),e=n}),i):this},t.disown=function(){var t,e,n=this,i=n.ends[w];return!i||n.disowned?n:(n.disowned=!0,t=n.ends[y],e=i.parent,o(e,i[w],i),o(e,t,t[y]),i[w]?i[w][y]=t[y]:e.ends[w]=t[y],t[y]?t[y][w]=i[w]:e.ends[y]=i[w],n)},t.remove=function(){return this.jQ.remove(),this.each("postOrder","dispose"),this.disown()},t.each=n(function(t){var e=this,n=e.ends[w];if(!n)return e;for(;n!==e.ends[y][y]&&!1!==t(n);n=n[y]);return e}),t.fold=function(t,e){return this.each(function(n){t=e.call(this,t,n)}),t}}),T={},j={},C=v(q,function(t){t.init=function(t,e){var n,i,s,r,o,a;this.parent=t,this.options=e,n=this.jQ=this._jQ=x('<span class="mq-cursor">&#8203;</span>'),this.blink=function(){n.toggleClass("mq-blink")},this.upDownCache={},i=this.ctrlr=this.parent.controller,s='<span style="position: absolute; z-index: 1; left: -22px; top: 0px; width: 44px; height: 44px;"><svg width="22" height="26.509999999999998" viewBox="-11 0 22 26.509999999999998" style="margin-left: 11px;"><path d="M 0 0 L -7.776999999999999 7.776999999999999 A 11 11, 0, 1, 0, 7.776999999999999 7.776999999999999 Z" fill="blue"></path></svg></span>',this.touchcursors=x('<span style="position: relative;"></span>'),this.touchcursors.append(this.touchcursor=x(s)),this.touchcursor[0].style.display="none",this.touchcursors.append(this.touchanticursor=x(s)),this.touchanticursor[0].style.display="none",r=this.menu=x('<div class="mathquill-edit-menu"><ul class="menu-options"><li class="menu-option">Copy</li><li class="menu-option">Cut</li><li class="menu-option">Paste</li></ul></div>'),o=this.touchcursors,this.touchcursors=x("<span></span>"),this.touchcursors.append(o),this.touchcursors.append(r),a=this,r.bind("touchstart",function(t){switch(t.stopPropagation(),a.toggleMenu("hide"),a.ctrlr.textarea.focus(),t.target.innerHTML){case"Copy":document.execCommand("copy")||alert("copy failed :(");break;case"Cut":document.execCommand("cut")||alert("cut failed :(");break;case"Paste":if(!document.execCommand("paste")){var e=function(t){alert("paste failed :(")};if(!navigator.clipboard||"function"!=typeof navigator.clipboard.readText)return e();navigator.clipboard.readText().then(function(t){i.paste(t)}).catch(e)}}}),r.bind("touchmove touchend touchcancel",function(t){t.stopPropagation(),t.preventDefault()}),a=this,this.touchcursor.cursor=this,this.touchanticursor.cursor=this,this.touchcursor.other=this.touchanticursor,this.touchanticursor.other=this.touchcursor,this.touchcursor.bind("touchstart",function(){a.onCursorHandleTouchStart.apply(a.touchcursor,arguments)}),this.touchcursor.bind("touchmove",function(){a.onCursorHandleTouchMove.apply(a.touchcursor,arguments)}),this.touchcursor.bind("touchcancel touchend",function(){a.onCursorHandleTouchEnd.apply(a.touchcursor,arguments)}),this.touchanticursor.bind("touchstart",function(){a.onCursorHandleTouchStart.apply(a.touchanticursor,arguments)}),this.touchanticursor.bind("touchmove",function(){a.onCursorHandleTouchMove.apply(a.touchanticursor,arguments)}),this.touchanticursor.bind("touchcancel touchend",function(){a.onCursorHandleTouchEnd.apply(a.touchanticursor,arguments)})},t.show=function(){return this.jQ=this._jQ.removeClass("mq-blink"),"intervalId"in this?clearInterval(this.intervalId):(this[y]?this.selection&&this.selection.ends[w][w]===this[w]?this.jQ.insertBefore(this.selection.jQ):this.jQ.insertBefore(this[y].jQ.first()):this.jQ.appendTo(this.parent.jQ),this.parent.focus()),this.touchcursor.dragging||this.touchanticursor.dragging||(this.touchcursor[0].style.display="none"),this.toggleMenu("hide"),this.intervalId=setInterval(this.blink,500),this},t.hide=function(){return this.touchcursor.dragging||this.touchanticursor.dragging||(this.touchcursor[0].style.display="none"),this.toggleMenu("hide"),"intervalId"in this&&clearInterval(this.intervalId),delete this.intervalId,this.jQ.detach(),this.jQ=x(),this},t.withDirInsertAt=function(t,e,n,i){var s=this.parent;this.parent=e,this[t]=n,this[-t]=i,s!==e&&s.blur&&s.blur(this)},t.insDirOf=function(t,e){return r(t),this.jQ.insDirOf(t,e.jQ),this.withDirInsertAt(t,e.parent,e[t],e),this.parent.jQ.addClass("mq-hasCursor"),this},t.insLeftOf=function(t){return this.insDirOf(w,t)},t.insRightOf=function(t){return this.insDirOf(y,t)},t.insAtDirEnd=function(t,e){return r(t),this.jQ.insAtDirEnd(t,e.jQ),this.withDirInsertAt(t,e,0,e.ends[t]),e.focus(),this},t.insAtLeftEnd=function(t){return this.insAtDirEnd(w,t)},t.insAtRightEnd=function(t){return this.insAtDirEnd(y,t)},t.jumpUpDown=function(t,e){var n,i,s=this;s.upDownCache[t.id]=q.copy(s),n=s.upDownCache[e.id],n?n[y]?s.insLeftOf(n[y]):s.insAtRightEnd(n.parent):(i=s.offset().left,e.seek(i,0,s))},t.offset=function(){var t=this,e=t.jQ.removeClass("mq-cursor").offset();return t.jQ.addClass("mq-cursor"),e},t.unwrapGramp=function(){var t=this.parent.parent,e=t.parent,n=t[y],i=this,s=t[w];if(t.disown().eachChild(function(i){i.isEmpty()||(i.children().adopt(e,s,n).each(function(e){e.jQ.insertBefore(t.jQ.first())}),s=i.ends[y])}),!this[y])if(this[w])this[y]=this[w][y];else for(;!this[y];){if(this.parent=this.parent[y],!this.parent){this[y]=t[y],this.parent=e;break}this[y]=this.parent.ends[w]}this[y]?this.insLeftOf(this[y]):this.insAtRightEnd(e),t.jQ.remove(),t[w].siblingDeleted&&t[w].siblingDeleted(i.options,y),t[y].siblingDeleted&&t[y].siblingDeleted(i.options,w)},t.startSelection=function(){var t,e=this.anticursor=q.copy(this),n=e.ancestors={};for(t=e;t.parent;t=t.parent)n[t.parent.id]=t},t.endSelection=function(){delete this.anticursor},t.select=function(){var t,e,n,i,r,o,a,l,c=this.anticursor;if(this[w]===c[w]&&this.parent===c.parent)return!1;for(t=this;t.parent;t=t.parent)if(t.parent.id in c.ancestors){e=t.parent;break}if(s("cursor and anticursor in the same tree",e),n=c.ancestors[e.id],o=y,t[w]!==n)for(a=t;a;a=a[y])if(a[y]===n[y]){o=w,i=t,r=n;break}return o===y&&(i=n,r=t),i instanceof q&&(i=i[y]),r instanceof q&&(r=r[w]),this.hide().selection=e.selectChildren(i,r),this.insDirOf(o,this.selection.ends[o]),this.selectionChanged(),this.ctrlr.container.prepend(this.touchcursors),l=this,""!=l.touchcursor[0].style.display&&""!=l.touchanticursor[0].style.display||(l.touchcursor[0].style.display="",l.touchanticursor[0].style.display="",setTimeout(function(){var t,e,n,i,s;l.selection&&l.touchcursors[0]&&(t=l.touchcursors[0].getBoundingClientRect(),e=l.selection.ends[y].jQ[0].getBoundingClientRect(),n=l.selection.ends[w].jQ[0].getBoundingClientRect(),i=function(n){var i=e;n.last={x:i.right-t.left,y:i.bottom-t.top},n[0].style.transform="translate("+n.last.x+"px, "+n.last.y+"px)"},s=function(e){var i=n;e.last={x:i.left-t.left,y:i.bottom-t.top},e[0].style.transform="translate("+e.last.x+"px, "+e.last.y+"px)"},l.touchcursor.dragging?l.touchcursor.last.x-window.scrollX<(e.right+n.left)/2?i(l.touchanticursor):s(l.touchanticursor):l.touchanticursor.dragging&&(l.touchanticursor.last.x-window.scrollX<(e.right+n.left)/2?i(l.touchcursor):s(l.touchcursor)),l.toggleMenu("hide"))},0),this.selection.clear=function(){Q.prototype.clear.apply(this,arguments),l.touchcursor.dragging||l.touchanticursor.dragging||(l.touchcursor[0].style.display="none",l.touchanticursor[0].style.display="none",l.toggleMenu("hide"))}),!0},t.clearSelection=function(){return this.selection&&(this.selection.clear(),delete this.selection,this.selectionChanged()),this},t.deleteSelection=function(){this.selection&&(this.touchcursor[0].style.display="none",this.touchanticursor[0].style.display="none",this[w]=this.selection.ends[w][w],this[y]=this.selection.ends[y][y],this.selection.remove(),this.selectionChanged(),delete this.selection)},t.replaceSelection=function(){var t,e=this.selection;return e&&(t=this,t.touchanticursor[0].style.display="none",t.touchcursor[0].style.display="none",this[w]=e.ends[w][w],this[y]=e.ends[y][y],delete this.selection),e},t.depth=function(){for(var t=this,e=0;t=t.parent;)e+=t instanceof W?1:0;return e},t.isTooDeep=function(t){if(this.options.maxDepth!==m)return this.depth()+(t||0)>this.options.maxDepth},t.onCursorHandleTouchStart=function(t){var e,n,i,s,r,o,a,l,c;if(t.stopPropagation(),t.preventDefault(),this.dragging=!0,this.showmenu=!0,this.cursor.toggleMenu("hide"),this.last=this.start={x:t.originalEvent.touches[0].pageX,y:t.originalEvent.touches[0].pageY},e=this.last.x,n=this.cursor,n.selection&&(this.blockunselectinto=!1,this.blockselectoutof=!1,i=n.selection.jQ[0].getBoundingClientRect(),(s=n.selection.ends[w][w]===n[w]?w:y)===w&&i.left+i.width/2<e-window.scrollX||s===y&&i.left+i.width/2>e-scrollX))for(r=s===w?n:n.anticursor,o=s===y?n:n.anticursor,r[w]=n.selection.ends[y],r[y]=n.selection.ends[y][y],o[w]=n.selection.ends[w][w],o[y]=n.selection.ends[w],n.anticursor.parent=n.parent,a=n.anticursor,l=a.ancestors={},c=a;c.parent;c=c.parent)l[c.parent.id]=c},t.onCursorHandleTouchMove=function(t){var e,n,i,s,r,o,a,l,c,u;t.stopPropagation(),this.last={x:t.originalEvent.touches[0].pageX,y:t.originalEvent.touches[0].pageY},e=this.last.x,n=this.last.y-22,i=this.cursor,i.selection?1==i.selection.jQ.length?(s=i.selection.jQ[0].getBoundingClientRect(),r=i.selection.ends[w][w]===i[w]?w:y,o=!1,i.selection.clear(),this.blockunselectinto&&(r==w&&e-window.scrollX<s.left||r==y&&e-window.scrollX>s.right)?this.blockunselectinto=!1:!o&&!this.blockunselectinto&&(r==w&&e-window.scrollX>s.left||r==y&&e-window.scrollX<s.right)&&i[-r].id in i.anticursor.ancestors&&(i[-r].unselectInto(-r,i),i.select(),o=!0,this.blockselectoutof=!0),o||0==i[w]||(a=i[w].jQ[0].getBoundingClientRect(),e-window.scrollX<(a.left+a.right)/2&&(i.ctrlr.selectDir(w),o=!0)),o||0==i[y]||(a=i[y].jQ[0].getBoundingClientRect(),e-window.scrollX>(a.left+a.right)/2&&(i.ctrlr.selectDir(y),o=!0)),!o&&this.blockselectoutof&&(r==w&&e-window.scrollX>=s.left||r==y&&e-window.scrollX<=s.right)?this.blockselectoutof=!1:o||this.blockselectoutof||0!=i[r]||!i.parent.parent||(l=i[-r],c=i.parent,i.parent.selectOutOf(r,i),a=i[-r].jQ[0].getBoundingClientRect(),r==w&&e-window.scrollX>(a.left+s.left)/2||r==y&&e-window.scrollX<(s.right+a.right)/2?(i[-r]=l,i[r]=0,i.parent=c):(this.blockunselectinto=!0,i.select(),o=!0)),o||i.select(),i.selection||(this.other[0].style.display="none")):this.other[0].style.display="none":i.ctrlr.seek(m,e,n),this.showmenu&=Math.abs(this.start.x-e)<=20&&Math.abs(this.start.y-n)<=20,u=i.touchcursors[0].getBoundingClientRect(),this[0].style.transform="translate("+(e-u.left-window.scrollX)+"px, "+(n-u.top-window.scrollY)+"px)"},t.onCursorHandleTouchEnd=function(t){var e,n,i,s,r,o;t.stopPropagation(),this.dragging=!1,this.blockunselectinto=!1,e=this,n=this.last.x,i=this.last.y,this.showmenu&&(s=this[0].getBoundingClientRect(),n=(s.left+s.right)/2,i=s.top,r=x(window).height(),o=x(window).width(),i>r/2&&n<=o/2?(this.cursor.menu.css("left",n),this.cursor.menu.css("bottom",r-i),this.cursor.menu.css("right","auto"),this.cursor.menu.css("top","auto")):i>r/2&&n>o/2?(this.cursor.menu.css("right",o-n),this.cursor.menu.css("bottom",r-i),this.cursor.menu.css("left","auto"),this.cursor.menu.css("top","auto")):i<=r/2&&n<=o/2?(this.cursor.menu.css("left",n),this.cursor.menu.css("top",i),this.cursor.menu.css("right","auto"),this.cursor.menu.css("bottom","auto")):(this.cursor.menu.css("right",o-n),this.cursor.menu.css("top",i),this.cursor.menu.css("left","auto"),this.cursor.menu.css("bottom","auto")),this.cursor.toggleMenu("show")),this.cursor.selection?(e=this.cursor,setTimeout(function(){var t,n;e.selection&&e.touchcursors[0]&&(t=e.touchcursors[0].getBoundingClientRect(),e.touchcursor.dragging||(n=e.selection.ends[y].jQ[0].getBoundingClientRect(),e.touchcursor[0].style.transform="translate("+(n.right-t.left)+"px, "+(n.bottom-t.top)+"px)"),e.touchanticursor.dragging||(n=e.selection.ends[w].jQ[0].getBoundingClientRect(),e.touchanticursor[0].style.transform="translate("+(n.left-t.left)+"px, "+(n.bottom-t.top)+"px)"))},0)):setTimeout(function(){var t,n;e.cursor.jQ[0]&&(t=e.cursor.touchcursors[0].getBoundingClientRect(),n=e.cursor.jQ[0].getBoundingClientRect(),e[0].style.transform="translate("+(n.left-t.left)+"px, "+(n.bottom-t.top)+"px)")},0)},t.toggleMenu=function(t){if("show"===t){var e=this.menu[0].querySelectorAll('li[class="menu-option"]');this.ctrlr.editable?this.selection?(e.item(0).style.display="",e.item(1).style.display="",e.item(2).style.display=""):(e.item(0).style.display="none",e.item(1).style.display="none",e.item(2).style.display=""):(e.item(0).style.display="",e.item(1).style.display="none",e.item(2).style.display="none"),this.menu[0].style.display="block"}else this.menu[0].style.display="none"},t.showTouchCursors=function(){this.ctrlr.container.prepend(this.touchcursors);var t=this;t.toggleMenu("hide"),this.selection?(t.touchcursor[0].style.display="",t.touchanticursor[0].style.display="",setTimeout(function(){var e,n;t.selection&&t.touchcursors[0]&&(e=t.touchcursors[0].getBoundingClientRect(),t.touchcursor.dragging||(n=t.selection.ends[y].jQ[0].getBoundingClientRect(),t.touchcursor[0].style.transform="translate("+(n.right-e.left)+"px, "+(n.bottom-e.top)+"px)"),t.touchanticursor.dragging||(n=t.selection.ends[w].jQ[0].getBoundingClientRect(),t.touchanticursor[0].style.transform="translate("+(n.left-e.left)+"px, "+(n.bottom-e.top)+"px)"))},0),this.selection.clear=function(){Q.prototype.clear.apply(this,arguments),t.touchcursor.dragging||t.touchanticursor.dragging||(t.touchanticursor[0].style.display="none",t.touchcursor[0].style.display="none",t.toggleMenu("hide"))}):t.ctrlr.editable&&(t.touchcursor[0].style.display="",setTimeout(function(){var e,n;t.jQ[0]&&(e=t.touchcursors[0].getBoundingClientRect(),n=t.jQ[0].getBoundingClientRect(),t.touchcursor[0].style.transform="translate("+(n.left-e.left)+"px, "+(n.bottom-e.top)+"px)")},0))}}),Q=v(O,function(t,e){t.init=function(){e.init.apply(this,arguments),this.jQ=this.jQ.wrapAll('<span class="mq-selection"></span>').parent()},t.adopt=function(){return this.jQ.replaceWith(this.jQ=this.jQ.children()),e.adopt.apply(this,arguments)},t.clear=function(){return this.jQ.replaceWith(this.jQ[0].childNodes),this},t.join=function(t){return this.fold("",function(e,n){return e+n[t]()})}}),D=v(function(t){t.init=function(t,e,n){this.id=t.id,this.data={},this.root=t,this.container=e,this.options=n,t.controller=this,this.cursor=t.cursor=C(t,n)},t.handle=function(t,e){var n,i=this.options.handlers;i&&i.fns[t]&&(n=i.APIClasses[this.KIND_OF_MQ](this),e===w||e===y?i.fns[t](e,n):i.fns[t](n))};var e=[];this.onNotify=function(t){e.push(t)},t.notify=function(){for(var t=0;t<e.length;t+=1)e[t].apply(this.cursor,arguments);return this}}),S={},_=v(),E={},A=v(),L={},l.prototype=A.p,l.VERSION="v0.10.1",l.interfaceVersion=function(t){if(1!==t)throw"Only interface version 1 supported. You specified: "+t;return a=function(){window.console&&console.warn('You called MathQuill.interfaceVersion(1); to specify the interface version, which will fail in v1.0.0. You can fix this easily by doing this before doing anything else:\n\n    MathQuill = MathQuill.getInterface(1);\n    // now MathQuill.MathField() works like it used to\n\nSee also the "`dev` branch (2014–2015) → v0.10.0 Migration Guide" at\n  https://github.com/mathquill/mathquill/wiki/%60dev%60-branch-(2014%E2%80%932015)-%E2%86%92-v0.10.0-Migration-Guide')},a(),l},l.getInterface=c,R=c.MIN=1,B=c.MAX=2,l.noConflict=function(){return window.MathQuill=I,l},I=window.MathQuill,window.MathQuill=l,M=function(){function e(t){var e,i=t.which||t.keyCode,s=n[i],r=[];return t.ctrlKey&&r.push("Ctrl"),t.originalEvent&&t.originalEvent.metaKey&&r.push("Meta"),t.altKey&&r.push("Alt"),t.shiftKey&&r.push("Shift"),e=s||String.fromCharCode(i),r.length||s?(r.push(e),r.join("-")):e}var n={8:"Backspace",9:"Tab",10:"Enter",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Del",144:"NumLock"};return function(n,i){function s(t){O=t,clearTimeout(g),g=setTimeout(t)}function r(e){s(function(n){O=t,clearTimeout(g),e(n)})}function o(e){O(),O=t,clearTimeout(g),q.val(e),e&&q[0].select&&q[0].select(),b=!!e}function a(){var t=q[0];return"selectionStart"in t&&t.selectionStart!==t.selectionEnd}function l(){v&&229===y.which?(w=!0,q.val("\0")):i.keystroke(e(y),y)}function c(t){y=t,x=null,b&&r(function(t){t&&"focusout"===t.type||!q[0].select||q[0].select()}),l()}function u(t){y&&x&&l(),x=t,s(p)}function h(t){y&&!x&&s(p)}function p(){var t,e;if(w){if(t=q.val(),w=!1,q.val(""),0==t.length)i.keystroke("Backspace",y);else if(t.length>=2&&(t=t.substring(1),i.keystroke(" "===t?"Spacebar":t,y),!y.isDefaultPrevented()))for(e=0;e<t.length;e+=1)i.typedText(t.charAt(e))}else{if(a())return;if(t=q.val(),t.length>=1)for(q.val(""),e=0;e<t.length;e+=1)i.typedText(t.charAt(e));else t&&q[0].select&&q[0].select()}}function f(){y=x=null}function d(t){q.focus(),s(m)}function m(){var t=q.val();q.val(""),t&&i.paste(t)}var g,b,v=/.*android.*/i.test(navigator.userAgent),w=!1,y=null,x=null,q=Mt(n),k=Mt(i.container||q),O=t;return k.bind("keydown keypress input keyup focusout paste",function(t){O(t)}),b=!1,k.bind({keydown:c,keypress:u,keyup:h,focusout:f,cut:function(){r(function(){i.cut()})},copy:function(){r(function(){i.copy()})},paste:d}),{select:o}}}(),z=v(function(t,e,n){function i(t,e){throw t=t?"'"+t+"'":"EOF","Parse Error: "+e+" at "+t}var r,o,a;t.init=function(t){this._=t},t.parse=function(t){function e(t,e){return e}return this.skip(a)._(""+t,e,i)},t.or=function(t){s("or is passed a parser",t instanceof n);var e=this;return n(function(n,i,s){function r(e){return t._(n,i,s)}return e._(n,i,r)})},t.then=function(t){var e=this;return n(function(i,r,o){function a(e,i){var a=t instanceof n?t:t(i);return s("a parser is returned",a instanceof n),a._(e,r,o)}return e._(i,a,o)})},t.many=function(){var t=this;return n(function(e,n,i){function s(t,n){return e=t,o.push(n),!0}function r(){return!1}for(var o=[];t._(e,s,r););return n(e,o)})},t.times=function(t,e){arguments.length<2&&(e=t);var i=this;return n(function(n,s,r){function o(t,e){return h.push(e),n=t,!0}function a(t,e){return c=e,n=t,!1}function l(t,e){return!1}var c,u,h=[],p=!0;for(u=0;u<t;u+=1)if(!(p=i._(n,o,a)))return r(n,c);for(;u<e&&p;u+=1)p=i._(n,o,l);return s(n,h)})},t.result=function(t){return this.then(o(t))},t.atMost=function(t){return this.times(0,t)},t.atLeast=function(t){var e=this;return e.times(t).then(function(t){return e.many().map(function(e){return t.concat(e)})})},t.map=function(t){return this.then(function(e){return o(t(e))})},t.skip=function(t){return this.then(function(e){return t.result(e)})},this.string=function(t){var e=t.length,i="expected '"+t+"'";return n(function(n,s,r){var o=n.slice(0,e);return o===t?s(n.slice(e),o):r(n,i)})},r=this.regex=function(t){s("regexp parser is anchored","^"===t.toString().charAt(1));var e="expected "+t;return n(function(n,i,s){var r,o=t.exec(n);return o?(r=o[0],i(n.slice(r.length),r)):s(n,e)})},o=n.succeed=function(t){return n(function(e,n){return n(e,t)})},n.fail=function(t){return n(function(e,n,i){return i(e,t)})},n.letter=r(/^[a-z]/i),n.letters=r(/^[a-z]*/i),n.digit=r(/^[0-9]/),n.digits=r(/^[0-9]*/),n.whitespace=r(/^\s+/),n.optWhitespace=r(/^\s*/),n.any=n(function(t,e,n){return t?e(t.slice(1),t.charAt(0)):n(t,"expected any character")}),n.all=n(function(t,e,n){return e("",t)}),a=n.eof=n(function(t,e,n){return t?n(t,"expected EOF"):e(t,t)})}),D.open(function(t){t.focusBlurEvents=function(){function t(){clearTimeout(n),r.selection&&r.selection.jQ.addClass("mq-blur"),e()}function e(){r.hide().parent.blur(),i.container.removeClass("mq-focused"),x(window).unbind("blur",t)}var n,i=this,s=i.root,r=i.cursor;i.textarea.focus(function(){i.blurred=!1,clearTimeout(n),i.container.addClass("mq-focused"),r.parent||r.insAtRightEnd(s),r.selection?(r.selection.jQ.removeClass("mq-blur"),i.selectionChanged()):r.show()}).blur(function(){i.blurred=!0,n=setTimeout(function(){s.postOrder("intentionalBlur"),r.clearSelection().endSelection(),e()}),x(window).bind("blur",t)}),i.blurred=!0,r.hide().parent.blur()}}),D.open(function(t,e){t.exportText=function(){return this.root.foldChildren("",function(t,e){return t+e.text()})}}),D.open(function(e){_.p.ignoreNextMousedown=t,e.delegateMouseEvents=function(){var e,n,i,s,r,o=this.root.jQ;this.container.bind("mousedown.mathquill",function(e){function n(t){r=x(t.target)}function i(t){u.anticursor||u.startSelection(),c.seek(r,t.pageX,t.pageY).cursor.select(),r=m}function s(t){u.blink=h,u.selection||(c.editable?u.show():p.detach()),a.unbind("mousemove",n),x(t.target.ownerDocument).unbind("mousemove",i).unbind("mouseup",s)}var r,a=x(e.target).closest(".mq-root-block"),l=k.byId[a.attr(Ft)||o.attr(Ft)],c=l.controller,u=c.cursor,h=u.blink,p=c.textareaSpan,f=c.textarea;e.preventDefault(),e.target.unselectable=!0,u.options.ignoreNextMousedown(e)||(u.options.ignoreNextMousedown=t,c.blurred&&(c.editable||a.prepend(p),f.focus()),u.blink=t,c.seek(x(e.target),e.pageX,e.pageY).cursor.startSelection(),a.mousemove(n),x(e.target.ownerDocument).mousemove(i).mouseup(s))}),e=null,n=null,r=function(t,e){var n=s.x,i=(s.y,e.jQ[0].getBoundingClientRect());t.selectDir(i.left-n>n-i.right?w:y),e.showTouchCursors()},this.container.bind("touchstart.mathquill",function(t){var n=x(t.target).closest(".mq-root-block"),a=k.byId[n.attr(Ft)||o.attr(Ft)],l=a.controller,c=l.cursor,u=(c.blink,l.textareaSpan),h=l.textarea;t.preventDefault(),l.blurred&&(l.editable||n.prepend(u),h.focus()),s=i={x:t.originalEvent.touches[0].pageX,y:t.originalEvent.touches[0].pageY},l.seek(x(t.target),i.x,i.y).cursor.startSelection(),c.showTouchCursors(),e=setTimeout(function(){e=null,r(l,c)},500)}),this.container.bind("touchmove.mathquill",function(t){var n,r;t.stopPropagation(),s={
x:t.originalEvent.touches[0].pageX,y:t.originalEvent.touches[0].pageY},n=s.x,r=s.y,(Math.abs(i.x-n)>20||Math.abs(i.y-r)>20)&&null!==e&&(clearTimeout(e),e=null)}),this.container.bind("touchend.mathquill touchcancel.mathquill",function(t){var i=x(t.target).closest(".mq-root-block"),s=k.byId[i.attr(Ft)||o.attr(Ft)],a=s.controller,l=a.cursor,c=(l.blink,a.textareaSpan),u=a.textarea;null!==e&&(clearTimeout(e),e=null,null===n?n=setTimeout(function(){n=null},500):(clearTimeout(n),n=null,r(a,l))),t.preventDefault(),a.blurred&&(a.editable||i.prepend(c),u.focus())})}}),D.open(function(t){t.seek=function(t,e,n){var i,r,o,a=this.notify("select").cursor;return t&&((i=t.attr(Ft)||t.attr(zt))||(r=t.parent(),i=r.attr(Ft)||r.attr(zt))),o=i?k.byId[i]:this.root,s("nodeId is the id of some Node that exists",o),a.clearSelection().show(),o.seek(e,n,a),this.scrollHoriz(),this}}),D.open(function(t){t.keystroke=function(t,e){this.cursor.parent.keystroke(t,e,this)}}),k.open(function(t){t.keystroke=function(t,e,n){var i=n.cursor;switch(t){case"Ctrl-Shift-Backspace":case"Ctrl-Backspace":n.ctrlDeleteDir(w);break;case"Shift-Backspace":case"Backspace":n.backspace();break;case"Esc":case"Tab":return void n.escapeDir(y,t,e);case"Shift-Tab":case"Shift-Esc":return void n.escapeDir(w,t,e);case"End":n.notify("move").cursor.insAtRightEnd(i.parent);break;case"Ctrl-End":n.notify("move").cursor.insAtRightEnd(n.root);break;case"Shift-End":for(;i[y];)n.selectRight();break;case"Ctrl-Shift-End":for(;i[y]||i.parent!==n.root;)n.selectRight();break;case"Home":n.notify("move").cursor.insAtLeftEnd(i.parent);break;case"Ctrl-Home":n.notify("move").cursor.insAtLeftEnd(n.root);break;case"Shift-Home":for(;i[w];)n.selectLeft();break;case"Ctrl-Shift-Home":for(;i[w]||i.parent!==n.root;)n.selectLeft();break;case"Left":n.moveLeft();break;case"Shift-Left":n.selectLeft();break;case"Ctrl-Left":break;case"Right":n.moveRight();break;case"Shift-Right":n.selectRight();break;case"Ctrl-Right":break;case"Up":n.moveUp();break;case"Down":n.moveDown();break;case"Shift-Up":if(i[w])for(;i[w];)n.selectLeft();else n.selectLeft();case"Shift-Down":if(i[y])for(;i[y];)n.selectRight();else n.selectRight();case"Ctrl-Up":case"Ctrl-Down":break;case"Ctrl-Shift-Del":case"Ctrl-Del":n.ctrlDeleteDir(y);break;case"Shift-Del":case"Del":n.deleteForward();break;case"Meta-A":case"Ctrl-A":for(n.notify("move").cursor.insAtRightEnd(n.root);i[w];)n.selectLeft();break;default:return}e.preventDefault(),n.scrollHoriz()},t.moveOutOf=t.moveTowards=t.deleteOutOf=t.deleteTowards=t.unselectInto=t.selectOutOf=t.selectTowards=function(){s("overridden or never called on this node")}}),D.open(function(t){function e(t,e){var n=t.notify("upDown").cursor,i=e+"Into",s=e+"OutOf";return n[y][i]?n.insAtLeftEnd(n[y][i]):n[w][i]?n.insAtRightEnd(n[w][i]):n.parent.bubble(function(t){var e=t[s];if(e&&("function"==typeof e&&(e=t[s](n)),e instanceof k&&n.jumpUpDown(t,e),!0!==e))return!1}),t}this.onNotify(function(t){"move"!==t&&"upDown"!==t||this.show().clearSelection()}),t.escapeDir=function(t,e,n){r(t);var i=this.cursor;if(i.parent!==this.root&&n.preventDefault(),i.parent!==this.root)return i.parent.moveOutOf(t,i),this.notify("move")},E.leftRightIntoCmdGoes=function(t){if(t&&"up"!==t&&"down"!==t)throw'"up" or "down" required for leftRightIntoCmdGoes option, got "'+t+'"';return t},t.moveDir=function(t){r(t);var e=this.cursor,n=e.options.leftRightIntoCmdGoes;return e.selection?e.insDirOf(t,e.selection.ends[t]):e[t]?e[t].moveTowards(t,e,n):e.parent.moveOutOf(t,e,n),this.notify("move")},t.moveLeft=function(){return this.moveDir(w)},t.moveRight=function(){return this.moveDir(y)},t.moveUp=function(){return e(this,"up")},t.moveDown=function(){return e(this,"down")},this.onNotify(function(t){"upDown"!==t&&(this.upDownCache={})}),this.onNotify(function(t){"edit"===t&&this.show().deleteSelection()}),t.deleteDir=function(t){var e,n;return r(t),e=this.cursor,n=e.selection,this.notify("edit"),n||(e[t]?e[t].deleteTowards(t,e):e.parent.deleteOutOf(t,e)),e[w].siblingDeleted&&e[w].siblingDeleted(e.options,y),e[y].siblingDeleted&&e[y].siblingDeleted(e.options,w),e.parent.bubble("reflow"),this},t.ctrlDeleteDir=function(t){r(t);var e=this.cursor;return!e[t]||e.selection?this.deleteDir(t):(this.notify("edit"),t===w?O(e.parent.ends[w],e[w]).remove():O(e[y],e.parent.ends[y]).remove(),e.insAtDirEnd(t,e.parent),e[w].siblingDeleted&&e[w].siblingDeleted(e.options,y),e[y].siblingDeleted&&e[y].siblingDeleted(e.options,w),e.parent.bubble("reflow"),this)},t.backspace=function(){return this.deleteDir(w)},t.deleteForward=function(){return this.deleteDir(y)},this.onNotify(function(t){"select"!==t&&this.endSelection()}),t.selectDir=function(t){var e,n=this.notify("select").cursor,i=n.selection;r(t),n.anticursor||n.startSelection(),e=n[t],e?i&&i.ends[t]===e&&n.anticursor[-t]!==e?e.unselectInto(t,n):e.selectTowards(t,n):n.parent.selectOutOf(t,n),n.clearSelection(),n.select()||n.show()},t.selectLeft=function(){return this.selectDir(w)},t.selectRight=function(){return this.selectDir(y)}}),D.open(function(t){_.p.substituteTextarea=function(){return x("<textarea autocapitalize=off autocomplete=off autocorrect=off spellcheck=false x-palm-disable-ste-all=true />")[0]},t.createTextarea=function(){var t,e=this.textareaSpan=x('<span class="mq-textarea"></span>'),n=this.options.substituteTextarea();if(!n.nodeType)throw"substituteTextarea() must return a DOM element, got "+n;n=this.textarea=x(n).appendTo(e),t=this,t.cursor.selectionChanged=function(){t.selectionChanged()}},t.selectionChanged=function(){var t=this;J(t.container[0]),t.textareaSelectionTimeout===m&&(t.textareaSelectionTimeout=setTimeout(function(){t.setTextareaSelection()}))},t.setTextareaSelection=function(){this.textareaSelectionTimeout=m;var t="";this.cursor.selection&&(t=this.cursor.selection.join("latex"),this.options.statelessClipboard&&(t="$"+t+"$")),this.selectFn(t)},t.staticMathTextareaEvents=function(){function t(){s.detach(),e.blurred=!0}var e=this,n=(e.root,e.cursor),i=e.textarea,s=e.textareaSpan;this.container.prepend(Mt('<span class="mq-selectable">').text("$"+e.exportLatex()+"$")),e.blurred=!0,i.bind("cut paste",!1).bind("copy",function(){e.setTextareaSelection()}).focus(function(){e.blurred=!1}).blur(function(){n.selection&&n.selection.clear(),setTimeout(t)}),e.selectFn=function(t){i.val(t),t&&i.select()}},_.p.substituteKeyboardEvents=M,t.editablesTextareaEvents=function(){var t=this,e=t.textarea,n=t.textareaSpan,i=this.options.substituteKeyboardEvents(e,this);this.selectFn=function(t){i.select(t)},this.container.prepend(n),this.focusBlurEvents()},t.typedText=function(t){if("\n"===t)return this.handle("enter");var e=this.notify().cursor;e.parent.write(e,t),this.scrollHoriz()},t.cut=function(){var t=this,e=t.cursor;e.selection&&setTimeout(function(){t.notify("edit"),e.parent.bubble("reflow")})},t.copy=function(){this.setTextareaSelection()},t.paste=function(t){this.options.statelessClipboard&&(t="$"===t.slice(0,1)&&"$"===t.slice(-1)?t.slice(1,-1):"\\text{"+t+"}"),this.writeLatex(t).cursor.show()}}),F=function(){function t(t){var e=W();return t.adopt(e,0,0),e}function e(t){var e,n=t[0]||W();for(e=1;e<t.length;e+=1)t[e].children().adopt(n,n.ends[y],0);return n}var n=z.string,i=z.regex,s=z.letter,r=z.any,o=z.optWhitespace,a=z.succeed,l=z.fail,c=s.map(function(t){return kt(t)}),u=i(/^[\uD800-\uDBFF]?[^${}\\_^](\u200D[\uD800-\uDBFF]?[^${}\\_^])*/).map(function(t){return N(t)}),h=i(/^[^\\a-eg-zA-Z]/).or(n("\\").then(i(/^[a-z]+/i).or(i(/^\s+/).result(" ")).or(r))).then(function(t){var e=T[t];return e?e(t).parser():l("unknown command: \\"+t)}),p=h.or(c).or(u),f=n("{").then(function(){return m}).skip(n("}")),d=o.then(f.or(p.map(t))),m=d.many().map(e).skip(o),g=n("[").then(d.then(function(t){return"]"!==t.join("latex")?a(t):l()}).many().map(e).skip(o)).skip(n("]")),b=m;return b.block=d,b.optBlock=g,b}(),D.open(function(t,e){t.exportLatex=function(){return this.root.latex().replace(/(\\[a-z]+) (?![a-z])/gi,"$1")},E.maxDepth=function(t){return"number"==typeof t?t:m},t.writeLatex=function(t){var e,n=this.notify("edit").cursor,i=z.all,s=z.eof,r=F.skip(s).or(i.result(!1)).parse(t);return r&&!r.isEmpty()&&r.prepareInsertionAt(n)&&(r.children().adopt(n.parent,n[w],n[y]),e=r.jQize(),e.insertBefore(n.jQ),n[w]=r.ends[y],r.finalizeInsert(n.options,n),r.ends[y][y].siblingCreated&&r.ends[y][y].siblingCreated(n.options,w),r.ends[w][w].siblingCreated&&r.ends[w][w].siblingCreated(n.options,y),n.parent.bubble("reflow")),this},t.renderLatexMath=function(t){var e,n=this.root,i=this.cursor,s=(i.options,n.jQ),r=z.all,o=z.eof,a=F.skip(o).or(r.result(!1)).parse(t);n.eachChild("postOrder","dispose"),n.ends[w]=n.ends[y]=0,a&&a.prepareInsertionAt(i)?(a.children().adopt(n,0,0),e=a.join("html"),s.html(e),n.jQize(s.children()),n.finalizeInsert(i.options)):s.empty(),delete i.selection,i.insAtRightEnd(n)},t.renderLatexText=function(t){var e,n,i,s,r,o,a,l,c,u,h=this.root,p=this.cursor;if(h.jQ.children().slice(1).remove(),h.eachChild("postOrder","dispose"),h.ends[w]=h.ends[y]=0,delete p.selection,p.show().insAtRightEnd(h),e=z.regex,n=z.string,i=z.eof,s=z.all,r=n("$").then(F).skip(n("$").or(i)).map(function(t){var e,n=G(p);return n.createBlocks(),e=n.ends[w],t.children().adopt(e,0,0),n}),o=n("\\$").result("$"),a=o.or(e(/^[^$]/)).map(N),l=r.or(a).many(),c=l.skip(i).or(s.result(!1)).parse(t)){for(u=0;u<c.length;u+=1)c[u].adopt(h,h.ends[y],0);h.jQize().appendTo(h.jQ),h.finalizeInsert(p.options)}}}),D.open(function(t){t.scrollHoriz=function(){var t,e,n,i,s,r=this.cursor,o=r.selection,a=this.root.jQ[0].getBoundingClientRect();if(o)if(n=o.jQ[0].getBoundingClientRect(),i=n.left-(a.left+20),s=n.right-(a.right-20),o.ends[w]===r[y])if(i<0)e=i;else{if(!(s>0))return;e=n.left-s<a.left+20?i:s}else if(s>0)e=s;else{if(!(i<0))return;e=n.right-i>a.right-20?s:i}else if((t=r.jQ[0].getBoundingClientRect().left)>a.right-20)e=t-(a.right-20);else{if(!(t<a.left+20))return;e=t-(a.left+20)}this.root.jQ.stop().animate({scrollLeft:"+="+e},100)}}),P=v(k,function(t,e){t.finalizeInsert=function(t,e){var n=this;n.postOrder("finalizeTree",t),n.postOrder("contactWeld",e),n.postOrder("blur"),n.postOrder("reflow"),n[y].siblingCreated&&n[y].siblingCreated(t,w),n[w].siblingCreated&&n[w].siblingCreated(t,y),n.bubble("reflow")},t.prepareInsertionAt=function(t){var e,n=t.options.maxDepth;if(n!==m){if((e=t.depth())>n)return!1;this.removeNodesDeeperThan(n-e)}return!0},t.removeNodesDeeperThan=function(t){for(var e,n=0,i=[[this,n]];i.length;)e=i.shift(),e[0].children().each(function(s){var r=s instanceof W?1:0;n=e[1]+r,n<=t?i.push([s,n]):(r?s.children():s).remove()})}}),$=v(P,function(t,e){t.init=function(t,n,i){var s=this;e.init.call(s),s.ctrlSeq||(s.ctrlSeq=t),n&&(s.htmlTemplate=n),i&&(s.textTemplate=i)},t.replaces=function(t){t.disown(),this.replacedFragment=t},t.isEmpty=function(){return this.foldChildren(!0,function(t,e){return t&&e.isEmpty()})},t.parser=function(){var t=F.block,e=this;return t.times(e.numBlocks()).map(function(t){e.blocks=t;for(var n=0;n<t.length;n+=1)t[n].adopt(e,e.ends[y],0);return e})},t.createLeftOf=function(t){var n=this,i=n.replacedFragment;n.createBlocks(),e.createLeftOf.call(n,t),i&&(i.adopt(n.ends[w],0,0),i.jQ.appendTo(n.ends[w].jQ),n.placeCursor(t),n.prepareInsertionAt(t)),n.finalizeInsert(t.options),n.placeCursor(t)},t.createBlocks=function(){var t,e,n=this,i=n.numBlocks(),s=n.blocks=Array(i);for(t=0;t<i;t+=1)e=s[t]=W(),e.adopt(n,n.ends[y],0)},t.placeCursor=function(t){t.insAtRightEnd(this.foldChildren(this.ends[w],function(t,e){return t.isEmpty()?t:e}))},t.moveTowards=function(t,e,n){var i=n&&this[n+"Into"];e.insAtDirEnd(-t,i||this.ends[-t])},t.deleteTowards=function(t,e){this.isEmpty()?e[t]=this.remove()[t]:this.moveTowards(t,e,null)},t.selectTowards=function(t,e){e[-t]=this,e[t]=this[t]},t.selectChildren=function(){return Q(this,this)},t.unselectInto=function(t,e){e.insAtDirEnd(-t,e.anticursor.ancestors[this.id])},t.seek=function(t,e,n){function i(n){var i=n.jQ[0].getBoundingClientRect(),s=i.left-t,r=i.right-t,o=i.top-e,a=i.bottom-e;return i.distanceXl=s*s,i.distanceXr=r*r,i.distanceX=s*r<0?0:Math.min(i.distanceXl,i.distanceXr),i.distanceYt=o*o,i.distanceYb=a*a,i.distanceY=o*a<0?0:Math.min(i.distanceYt,i.distanceYb),i.distance=i.distanceX+i.distanceY,i}var s=this,r=i(s),o={distance:1/0};return 0==r.distanceX&&s.eachChild(function(t){var e=i(t);if(e.distance<o.distance&&(e.node=t,o=e,0===e.distance))return!1}),0!=r.distanceX||o.distance===1/0||r.distanceXl<o.distanceX||r.distanceXr<o.distanceX?t<(r.left+r.right)/2?n.insLeftOf(s):n.insRightOf(s):0===o.distanceX?o.node.seek(t,e,n):t<o.left?n.insAtLeftEnd(o.node):n.insAtRightEnd(o.node)},t.numBlocks=function(){var t=this.htmlTemplate.match(/&\d+/g);return t?t.length:0},t.html=function(){var t,e,n,i=this,r=i.blocks,o=" mathquill-command-id="+i.id,a=i.htmlTemplate.match(/<[^<>]+>|[^<>]+/g);for(s("no unmatched angle brackets",a.join("")===this.htmlTemplate),t=0,e=a[0];e;t+=1,e=a[t])if("/>"===e.slice(-2))a[t]=e.slice(0,-2)+o+"/>";else if("<"===e.charAt(0)){s("not an unmatched top-level close tag","/"!==e.charAt(1)),a[t]=e.slice(0,-1)+o+">",n=1;do{t+=1,e=a[t],s("no missing close tags",e),"</"===e.slice(0,2)?n-=1:"<"===e.charAt(0)&&"/>"!==e.slice(-2)&&(n+=1)}while(n>0)}return a.join("").replace(/>&(\d+)/g,function(t,e){return" mathquill-block-id="+r[e].id+">"+r[e].join("html")})},t.latex=function(){return this.foldChildren(this.ctrlSeq,function(t,e){return t+"{"+(e.latex()||" ")+"}"})},t.textTemplate=[""],t.text=function(){var t=this,e=0;return t.foldChildren(t.textTemplate[e],function(n,i){e+=1;var s=i.text();return n&&"("===t.textTemplate[e]&&"("===s[0]&&")"===s.slice(-1)?n+s.slice(1,-1)+t.textTemplate[e]:n+s+(t.textTemplate[e]||"")})}}),X=v($,function(e,n){e.init=function(t,e,i){i||(i=t&&t.length>1?t.slice(1):t),n.init.call(this,t,e,[i])},e.parser=function(){return z.succeed(this)},e.numBlocks=function(){return 0},e.replaces=function(t){t.remove()},e.createBlocks=t,e.moveTowards=function(t,e){e.jQ.insDirOf(t,this.jQ),e[-t]=this,e[t]=this[t]},e.deleteTowards=function(t,e){e[t]=this.remove()[t]},e.seek=function(t,e,n){t-this.jQ.offset().left<this.jQ.outerWidth()/2?n.insLeftOf(this):n.insRightOf(this)},e.latex=function(){return this.ctrlSeq},e.text=function(){return this.textTemplate},e.placeCursor=t,e.isEmpty=function(){return!0}}),N=v(X,function(t,e){t.init=function(t,n){e.init.call(this,t,"<span>"+(n||t)+"</span>")},t.createLeftOf=function(t){t[w]instanceof N&&(/[\u200D\uFE0F]/.test(this.ctrlSeq)||/^.*[\u200D\uD800-\uDBFF]$/.test(t[w].ctrlSeq))?(t[w].ctrlSeq+=this.ctrlSeq,t[w].htmlTemplate="<span>"+t[w].ctrlSeq+"</span>",t[w].jQ.text(t[w].ctrlSeq)):e.createLeftOf.apply(this,arguments)}}),H=v(X,function(t,e){t.init=function(t,n,i){e.init.call(this,t,'<span class="mq-binary-operator">'+n+"</span>",i)}}),W=v(P,function(t,e){t.join=function(t){return this.foldChildren("",function(e,n){return e+n[t]()})},t.html=function(){return this.join("html")},t.latex=function(){return this.join("latex")},t.text=function(){return this.ends[w]===this.ends[y]&&0!==this.ends[w]?this.ends[w].text():this.join("text")},t.keystroke=function(t,n,i){return!i.options.spaceBehavesLikeTab||"Spacebar"!==t&&"Shift-Spacebar"!==t?e.keystroke.apply(this,arguments):(n.preventDefault(),void i.escapeDir("Shift-Spacebar"===t?w:y,t,n))},t.moveOutOf=function(t,e,n){n&&this.parent[n+"Into"]||!this[t]?e.insDirOf(t,this.parent):e.insAtDirEnd(-t,this[t])},t.selectOutOf=function(t,e){e.insDirOf(t,this.parent)},t.deleteOutOf=function(t,e){e.unwrapGramp()},t.seek=function(t,e,n){var i=this.ends[y];if(!i||i.jQ.offset().left+i.jQ.outerWidth()<t)return n.insAtRightEnd(this);if(t<this.ends[w].jQ.offset().left)return n.insAtLeftEnd(this);for(;t<i.jQ.offset().left;)i=i[w];return i.seek(t,e,n)},t.chToCmd=function(t,e){var n;return t.match(/^[a-eg-zA-Z]$/)?kt(t):/^\d$/.test(t)?xt(t):e&&e.typingSlashWritesDivisionSymbol&&"/"===t?T["÷"](t):e&&e.typingAsteriskWritesTimesSymbol&&"*"===t?T["×"](t):(n=j[t]||T[t])?n(t):N(t)},t.write=function(t,e){var n=this.chToCmd(e,t.options);t.selection&&n.replaces(t.replaceSelection()),t.isTooDeep()||n.createLeftOf(t.show())},t.focus=function(){return this.jQ.addClass("mq-hasCursor"),this.jQ.removeClass("mq-empty"),this},t.blur=function(){return this.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&this.jQ.addClass("mq-empty"),this}}),_.p.mouseEvents=!0,S.StaticMath=function(t){return v(t.AbstractMathQuill,function(e,n){this.RootBlock=W,e.__mathquillify=function(t,e){return this.config(t),n.__mathquillify.call(this,"mq-math-mode"),this.__options.mouseEvents&&(this.__controller.delegateMouseEvents(),this.__controller.staticMathTextareaEvents()),this},e.init=function(){n.init.apply(this,arguments),this.__controller.root.postOrder("registerInnerField",this.innerFields=[],t.MathField)},e.latex=function(){var e=n.latex.apply(this,arguments);return arguments.length>0&&this.__controller.root.postOrder("registerInnerField",this.innerFields=[],t.MathField),e}})},U=v(W,u),S.MathField=function(e){return v(e.EditableField,function(e,n){this.RootBlock=U,e.__mathquillify=function(e,i){return this.config(e),i>1&&(this.__controller.root.reflow=t),n.__mathquillify.call(this,"mq-editable-field mq-math-mode"),delete this.__controller.root.reflow,this}})},V=v(k,function(t,e){function n(t){var e,n;if(t.jQ[0].normalize(),e=t.jQ[0].firstChild)return s("only node in TextBlock span is Text node",3===e.nodeType),n=Y(e.data),n.jQadd(e),t.children().disown(),n.adopt(t,0,0)}t.ctrlSeq="\\text",t.replaces=function(t){t instanceof O?this.replacedText=t.remove().jQ.text():"string"==typeof t&&(this.replacedText=t)},t.jQadd=function(t){e.jQadd.call(this,t),this.ends[w]&&this.ends[w].jQadd(this.jQ[0].firstChild)},t.createLeftOf=function(t){var n,i=this;if(e.createLeftOf.call(this,t),i[y].siblingCreated&&i[y].siblingCreated(t.options,w),i[w].siblingCreated&&i[w].siblingCreated(t.options,y),i.bubble("reflow"),t.insAtRightEnd(i),i.replacedText)for(n=0;n<i.replacedText.length;n+=1)i.write(t,i.replacedText.charAt(n))},t.parser=function(){var t=this,e=z.string,n=z.regex;return z.optWhitespace.then(e("{")).then(n(/^[^}]*/)).skip(e("}")).map(function(e){return 0===e.length?O():(Y(e).adopt(t,0,0),t)})},t.textContents=function(){return this.foldChildren("",function(t,e){return t+e.text})},t.text=function(){return'"'+this.textContents()+'"'},t.latex=function(){var t=this.textContents();return 0===t.length?"":"\\text{"+t.replace(/\\/g,"\\backslash ").replace(/[{}]/g,"\\$&")+"}"},t.html=function(){return'<span class="mq-text-mode" mathquill-command-id='+this.id+">"+this.textContents()+"</span>"},t.moveTowards=function(t,e){e.insAtDirEnd(-t,this)},t.moveOutOf=function(t,e){e.insDirOf(t,this)},t.unselectInto=t.moveTowards,t.selectTowards=$.prototype.selectTowards,t.deleteTowards=$.prototype.deleteTowards,t.selectOutOf=function(t,e){e.insDirOf(t,this)},t.deleteOutOf=function(t,e){this.isEmpty()&&e.insRightOf(this)},t.write=function(t,n){var i,s;t.show().deleteSelection(),"$"!==n?t[w]?t[w].appendText(n):Y(n).createLeftOf(t):this.isEmpty()?(t.insRightOf(this),N("\\$","$").createLeftOf(t)):t[y]?t[w]?(i=V(),s=this.ends[w],s.disown().jQ.detach(),s.adopt(i,0,0),t.insLeftOf(this),e.createLeftOf.call(i,t)):t.insLeftOf(this):t.insRightOf(this)},t.seek=function(t,e,i){var s,r,o,a,l,c,u,h;for(i.hide(),s=n(this),r=this.jQ.width()/this.text.length,o=Math.round((t-this.jQ.offset().left)/r),o<=0?i.insAtLeftEnd(this):o>=s.text.length?i.insAtRightEnd(this):i.insLeftOf(s.splitRight(o)),a=t-i.show().offset().left,l=a&&a<0?w:y,c=l;i[l]&&a*c>0;)i[l].moveTowards(l,i),c=a,a=t-i.offset().left;l*a<-l*c&&i[-l].moveTowards(-l,i),i.anticursor?i.anticursor.parent===this&&(u=i[w]&&i[w].text.length,this.anticursorPosition===u?i.anticursor=q.copy(i):(this.anticursorPosition<u?(h=i[w].splitRight(this.anticursorPosition),i[w]=h):h=i[y].splitRight(this.anticursorPosition-u),i.anticursor=q(this,h[w],h))):this.anticursorPosition=i[w]&&i[w].text.length},t.blur=function(t){W.prototype.blur.call(this),t&&(""===this.textContents()?(this.remove(),t[w]===this?t[w]=this[w]:t[y]===this&&(t[y]=this[y])):n(this))},t.focus=W.prototype.focus}),Y=v(k,function(t,e){function n(t,e){return e.charAt(t===w?0:-1+e.length)}t.init=function(t){e.init.call(this),this.text=t},t.jQadd=function(t){this.dom=t,this.jQ=x(t)},t.jQize=function(){return this.jQadd(document.createTextNode(this.text))},t.appendText=function(t){this.text+=t,this.dom.appendData(t)},t.prependText=function(t){this.text=t+this.text,this.dom.insertData(0,t)},t.insTextAtDirEnd=function(t,e){r(e),e===y?this.appendText(t):this.prependText(t)},t.splitRight=function(t){var e=Y(this.text.slice(t)).adopt(this.parent,this,this[y]);return e.jQadd(this.dom.splitText(t)),this.text=this.text.slice(0,t),e},t.moveTowards=function(t,e){var i,s;return r(t),i=n(-t,this.text),s=this[-t],s?s.insTextAtDirEnd(i,t):Y(i).createDir(-t,e),this.deleteTowards(t,e)},t.latex=function(){return this.text},t.deleteTowards=function(t,e){this.text.length>1?t===y?(this.dom.deleteData(0,1),this.text=this.text.slice(1)):(this.dom.deleteData(-1+this.text.length,1),this.text=this.text.slice(0,-1)):(this.remove(),this.jQ.remove(),e[t]=this[t])},t.selectTowards=function(t,e){var i,s,o,a;return r(t),i=e.anticursor,s=n(-t,this.text),i[t]===this?(o=Y(s).createDir(t,e),i[t]=o,e.insDirOf(t,o)):(a=this[-t],a?a.insTextAtDirEnd(s,t):(o=Y(s).createDir(-t,e),o.jQ.insDirOf(-t,e.selection.jQ)),1===this.text.length&&i[-t]===this&&(i[-t]=this[-t])),this.deleteTowards(t,e)}}),T.text=T.textnormal=T.textrm=T.textup=T.textmd=V,T.em=T.italic=T.italics=T.emph=T.textit=T.textsl=h("\\textit","i",'class="mq-text-mode"'),T.strong=T.bold=T.textbf=h("\\textbf","b",'class="mq-text-mode"'),T.sf=T.textsf=h("\\textsf","span",'class="mq-sans-serif mq-text-mode"'),T.tt=T.texttt=h("\\texttt","span",'class="mq-monospace mq-text-mode"'),T.textsc=h("\\textsc","span",'style="font-variant:small-caps" class="mq-text-mode"'),T.uppercase=h("\\uppercase","span",'style="text-transform:uppercase" class="mq-text-mode"'),T.lowercase=h("\\lowercase","span",'style="text-transform:lowercase" class="mq-text-mode"'),G=v($,function(t,e){t.init=function(t){e.init.call(this,"$"),this.cursor=t},t.htmlTemplate='<span class="mq-math-mode">&0</span>',t.createBlocks=function(){e.createBlocks.call(this),this.ends[w].cursor=this.cursor,this.ends[w].write=function(t,e){"$"!==e?W.prototype.write.call(this,t,e):this.isEmpty()?(t.insRightOf(this.parent),this.parent.deleteTowards(dir,t),N("\\$","$").createLeftOf(t.show())):t[y]?t[w]?W.prototype.write.call(this,t,e):t.insLeftOf(this.parent):t.insRightOf(this.parent)}},t.latex=function(){return"$"+this.ends[w].latex()+"$"}}),K=v(U,function(t,e){t.keystroke=function(t){if("Spacebar"!==t&&"Shift-Spacebar"!==t)return e.keystroke.apply(this,arguments)},t.write=function(t,e){if(t.show().deleteSelection(),"$"===e)G(t).createLeftOf(t);else{var n;"<"===e?n="&lt;":">"===e&&(n="&gt;"),N(e,n).createLeftOf(t)}}}),S.TextField=function(t){return v(t.EditableField,function(t,e){this.RootBlock=K,t.__mathquillify=function(){return e.__mathquillify.call(this,"mq-editable-field mq-text-mode")},t.latex=function(t){return arguments.length>0?(this.__controller.renderLatexText(t),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this):this.__controller.exportLatex()}})},j["\\"]=v($,function(t,e){t.ctrlSeq="\\",t.replaces=function(t){this._replacedFragment=t.disown(),this.isEmpty=function(){return!1}},t.htmlTemplate='<span class="mq-latex-command-input mq-non-leaf">\\<span>&0</span></span>',t.textTemplate=["\\"],t.createBlocks=function(){e.createBlocks.call(this),this.ends[w].focus=function(){return this.parent.jQ.addClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.removeClass("mq-empty"),this},this.ends[w].blur=function(){return this.parent.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.addClass("mq-empty"),this},this.ends[w].write=function(t,e){t.show().deleteSelection(),e.match(/[a-z]/i)?N(e).createLeftOf(t):(this.parent.renderCommand(t),"\\"===e&&this.isEmpty()||t.parent.write(t,e))},this.ends[w].keystroke=function(t,n,i){return"Tab"===t||"Enter"===t||"Spacebar"===t?(this.parent.renderCommand(i.cursor),void n.preventDefault()):e.keystroke.apply(this,arguments)}},t.createLeftOf=function(t){if(e.createLeftOf.call(this,t),this._replacedFragment){var n=this.jQ[0];this.jQ=this._replacedFragment.jQ.addClass("mq-blur").bind("mousedown mousemove",function(t){return x(t.target=n).trigger(t),!1}).insertBefore(this.jQ).add(this.jQ)}},t.latex=function(){return"\\"+this.ends[w].latex()+" "},t.renderCommand=function(t){var e,n;this.jQ=this.jQ.last(),this.remove(),this[y]?t.insLeftOf(this[y]):t.insAtRightEnd(this.parent),e=this.ends[w].latex(),e||(e=" "),n=T[e]||bt[e],n?(n=n(e),this._replacedFragment&&n.replaces(this._replacedFragment),n.createLeftOf(t)):(n=V(),n.replaces(e),n.createLeftOf(t),t.insRightOf(n),this._replacedFragment&&this._replacedFragment.remove())}}),J=t,tt=document.createElement("div"),et=tt.style,nt={transform:1,WebkitTransform:1,MozTransform:1,OTransform:1,msTransform:1};for(st in nt)if(st in et){it=st;break}it?Z=function(t,e,n){t.css(it,"scale("+e+","+n+")")}:"filter"in et?(J=function(t){t.className=t.className},Z=function(t,e,n){function i(){t.css("marginRight",(s.width()-1)*(e-1)/e+"px")}var s,r;e/=1+(n-1)/2,t.css("fontSize",n+"em"),t.hasClass("mq-matrixed-container")||t.addClass("mq-matrixed-container").wrapInner('<span class="mq-matrixed"></span>'),s=t.children().css("filter","progid:DXImageTransform.Microsoft.Matrix(M11="+e+",SizingMethod='auto expand')"),i(),r=setInterval(i),x(window).load(function(){clearTimeout(r),i()})}):Z=function(t,e,n){t.css("fontSize",n+"em")},rt=v($,function(t,e){t.init=function(t,n,i){e.init.call(this,t,"<"+n+" "+i+">&0</"+n+">")}}),T.mathrm=i(rt,"\\mathrm","span",'class="mq-roman mq-font"'),T.mathit=i(rt,"\\mathit","i",'class="mq-font"'),T.mathbf=i(rt,"\\mathbf","b",'class="mq-font"'),T.mathsf=i(rt,"\\mathsf","span",'class="mq-sans-serif mq-font"'),T.mathtt=i(rt,"\\mathtt","span",'class="mq-monospace mq-font"'),T.underline=i(rt,"\\underline","span",'class="mq-non-leaf mq-underline"'),T.overline=T.bar=i(rt,"\\overline","span",'class="mq-non-leaf mq-overline"'),T.overrightarrow=i(rt,"\\overrightarrow","span",'class="mq-non-leaf mq-overarrow mq-arrow-right"'),T.overleftarrow=i(rt,"\\overleftarrow","span",'class="mq-non-leaf mq-overarrow mq-arrow-left"'),T.overleftrightarrow=i(rt,"\\overleftrightarrow","span",'class="mq-non-leaf mq-overarrow mq-arrow-both"'),T.overarc=i(rt,"\\overarc","span",'class="mq-non-leaf mq-overarc"'),T.dot=v($,function(t,e){t.init=function(){e.init.call(this,"\\dot",'<span class="mq-non-leaf"><span class="mq-dot-recurring-inner"><span class="mq-dot-recurring">&#x2d9;</span><span class="mq-empty-box">&0</span></span></span>')}}),T.textcolor=v($,function(t,e){t.setColor=function(t){this.color=t,this.htmlTemplate='<span class="mq-textcolor" style="color:'+t+'">&0</span>'},t.latex=function(){return"\\textcolor{"+this.color+"}{"+this.blocks[0].latex()+"}"},t.parser=function(){var t=this,n=z.optWhitespace,i=z.string,s=z.regex;return n.then(i("{")).then(s(/^[#\w\s.,()%-]*/)).skip(i("}")).then(function(n){return t.setColor(n),e.parser.call(t)})},t.isStyleBlock=function(){return!0}}),T.class=v($,function(t,e){t.parser=function(){var t=this,n=z.string,i=z.regex;return z.optWhitespace.then(n("{")).then(i(/^[-\w\s\\\xA0-\xFF]*/)).skip(n("}")).then(function(n){return t.cls=n||"",t.htmlTemplate='<span class="mq-class '+n+'">&0</span>',e.parser.call(t)})},t.latex=function(){return"\\class{"+this.cls+"}{"+this.blocks[0].latex()+"}"},t.isStyleBlock=function(){return!0}}),ot=v($,function(t,e){t.ctrlSeq="_{...}^{...}",t.createLeftOf=function(t){if(this.replacedFragment||t[w]||!t.options.supSubsRequireOperand)return e.createLeftOf.apply(this,arguments)},t.contactWeld=function(t){var e,n,i,s,r,o;for(e=w;e;e=e===w&&y)if(this[e]instanceof ot){for(n="sub";n;n="sub"===n&&"sup")i=this[n],s=this[e][n],i&&(s?i.isEmpty()?o=q(s,0,s.ends[w]):(i.jQ.children().insAtDirEnd(-e,s.jQ),r=i.children().disown(),o=q(s,r.ends[y],s.ends[w]),e===w?r.adopt(s,s.ends[y],0):r.adopt(s,0,s.ends[w])):this[e].addBlock(i.disown()),this.placeCursor=function(t,n){return function(i){i.insAtDirEnd(-e,t||n)}}(s,i));this.remove(),t&&t[w]===this&&(e===y&&o?o[w]?t.insRightOf(o[w]):t.insAtLeftEnd(o.parent):t.insRightOf(this[e]));break}},_.p.charsThatBreakOutOfSupSub="",t.finalizeTree=function(){this.ends[w].write=function(t,e){if(t.options.autoSubscriptNumerals&&this===this.parent.sub){if("_"===e)return;var n=this.chToCmd(e,t.options);return n instanceof X?t.deleteSelection():t.clearSelection().insRightOf(this.parent),n.createLeftOf(t.show())}t[w]&&!t[y]&&!t.selection&&t.options.charsThatBreakOutOfSupSub.indexOf(e)>-1&&t.insRightOf(this.parent),W.p.write.apply(this,arguments)}},t.moveTowards=function(t,n,i){n.options.autoSubscriptNumerals&&!this.sup?n.insDirOf(t,this):e.moveTowards.apply(this,arguments)},t.deleteTowards=function(t,n){if(n.options.autoSubscriptNumerals&&this.sub){var i=this.sub.ends[-t];i instanceof X?i.remove():i&&i.deleteTowards(t,n.insAtDirEnd(-t,this.sub)),this.sub.isEmpty()&&(this.sub.deleteOutOf(w,n.insAtLeftEnd(this.sub)),this.sup&&n.insDirOf(-t,this))}else e.deleteTowards.apply(this,arguments)},t.latex=function(){function t(t,e){var n=e&&e.latex();return e?t+(1===n.length?n:"{"+(n||" ")+"}"):""}return t("_",this.sub)+t("^",this.sup)},t.addBlock=function(t){"sub"===this.supsub?(this.sup=this.upInto=this.sub.upOutOf=t,t.adopt(this,this.sub,0).downOutOf=this.sub,t.jQ=x('<span class="mq-sup"/>').append(t.jQ.children()).attr(Ft,t.id).prependTo(this.jQ)):(this.sub=this.downInto=this.sup.downOutOf=t,t.adopt(this,0,this.sup).upOutOf=this.sup,t.jQ=x('<span class="mq-sub"></span>').append(t.jQ.children()).attr(Ft,t.id).appendTo(this.jQ.removeClass("mq-sup-only")),this.jQ.append('<span style="display:inline-block;width:0">&#8203;</span>'));for(var e=0;e<2;e+=1)!function(t,e,n,i){t[e].deleteOutOf=function(s,r){if(r.insDirOf(this[s]?-s:s,this.parent),!this.isEmpty()){var o=this.ends[s];this.children().disown().withDirAdopt(s,r.parent,r[s],r[-s]).jQ.insDirOf(-s,r.jQ),r[-s]=o}t.supsub=n,delete t[e],delete t[i+"Into"],t[n][i+"OutOf"]=p,delete t[n].deleteOutOf,"sub"===e&&x(t.jQ.addClass("mq-sup-only")[0].lastChild).remove(),this.remove()}}(this,"sub sup".split(" ")[e],"sup sub".split(" ")[e],"down up".split(" ")[e])},t.reflow=function(){var t,e,n,i,s,r=this.jQ,o=r.prev();o.length&&(t=r.children(".mq-sup"),t.length&&(e=parseInt(t.css("font-size")),n=t.offset().top+t.height(),i=n-o.offset().top-.7*e,s=parseInt(t.css("margin-bottom")),t.css("margin-bottom",s+i)))}}),T.subscript=T._=v(ot,function(t,e){t.supsub="sub",t.htmlTemplate='<span class="mq-supsub mq-non-leaf"><span class="mq-sub">&0</span><span style="display:inline-block;width:0">&#8203;</span></span>',t.textTemplate=["_"],t.finalizeTree=function(){this.downInto=this.sub=this.ends[w],this.sub.upOutOf=p,e.finalizeTree.call(this)}}),T.superscript=T.supscript=T["^"]=v(ot,function(t,e){t.supsub="sup",t.htmlTemplate='<span class="mq-supsub mq-non-leaf mq-sup-only"><span class="mq-sup">&0</span></span>',t.textTemplate=["^"],t.finalizeTree=function(){this.upInto=this.sup=this.ends[y],this.sup.downOutOf=p,e.finalizeTree.call(this)}}),at=v($,function(t,e){t.init=function(t,e){var n='<span class="mq-large-operator mq-non-leaf"><span class="mq-to"><span>&1</span></span><big>'+e+'</big><span class="mq-from"><span>&0</span></span></span>';X.prototype.init.call(this,t,n)},t.createLeftOf=function(t){e.createLeftOf.apply(this,arguments),t.options.sumStartsWithNEquals&&(kt("n").createLeftOf(t),Rt().createLeftOf(t))},t.latex=function(){function t(t){return 1===t.length?t:"{"+(t||" ")+"}"}return this.ctrlSeq+"_"+t(this.ends[w].latex())+"^"+t(this.ends[y].latex())},t.parser=function(){var t,e=z.string,n=z.optWhitespace,i=z.succeed,s=F.block,r=this,o=r.blocks=[W(),W()];for(t=0;t<o.length;t+=1)o[t].adopt(r,r.ends[y],0)
;return n.then(e("_").or(e("^"))).then(function(t){var e=o["_"===t?0:1];return s.then(function(t){return t.children().adopt(e,e.ends[y],0),i(r)})}).many().result(r)},t.finalizeTree=function(){this.downInto=this.ends[w],this.upInto=this.ends[y],this.ends[w].upOutOf=this.ends[y],this.ends[y].downOutOf=this.ends[w]}}),T["∑"]=T.sum=T.summation=i(at,"\\sum ","&sum;"),T["∏"]=T.prod=T.product=i(at,"\\prod ","&prod;"),T.coprod=T.coproduct=i(at,"\\coprod ","&#8720;"),T["∫"]=T.int=T.integral=v(at,function(t,e){t.init=function(){X.prototype.init.call(this,"\\int ",'<span class="mq-int mq-non-leaf"><big>&int;</big><span class="mq-supsub mq-non-leaf"><span class="mq-sup"><span class="mq-sup-inner">&1</span></span><span class="mq-sub">&0</span><span style="display:inline-block;width:0">&#8203</span></span></span>')},t.createLeftOf=$.p.createLeftOf}),lt=T.frac=T.dfrac=T.cfrac=T.fraction=v($,function(t,e){t.ctrlSeq="\\frac",t.htmlTemplate='<span class="mq-fraction mq-non-leaf"><span class="mq-numerator">&0</span><span class="mq-denominator">&1</span><span style="display:inline-block;width:0">&#8203;</span></span>',t.textTemplate=["(",")/(",")"],t.finalizeTree=function(){this.upInto=this.ends[y].upOutOf=this.ends[w],this.downInto=this.ends[w].downOutOf=this.ends[y]}}),ct=T.over=j["/"]=v(lt,function(e,n){e.createLeftOf=function(e){if(!this.replacedFragment){for(var i=e[w];i&&!(i instanceof H||i instanceof(T.text||t)||i instanceof at||"\\ "===i.ctrlSeq||/^[.;:]$/.test(i.ctrlSeq));)i=i[w];i instanceof at&&i[y]instanceof ot&&(i=i[y],i[y]instanceof ot&&i[y].ctrlSeq!=i.ctrlSeq&&(i=i[y])),i===e[w]||e.isTooDeep(1)||(this.replaces(O(i[y]||e.parent.ends[w],e[w])),e[w]=i)}n.createLeftOf.call(this,e)}}),ut=T.sqrt=T["√"]=v($,function(t,e){t.ctrlSeq="\\sqrt",t.htmlTemplate='<span class="mq-non-leaf"><span class="mq-scaled mq-sqrt-prefix">&radic;</span><span class="mq-non-leaf mq-sqrt-stem">&0</span></span>',t.textTemplate=["sqrt(",")"],t.parser=function(){return F.optBlock.then(function(t){return F.block.map(function(e){var n=ht();return n.blocks=[t,e],t.adopt(n,0,0),e.adopt(n,t,0),n})}).or(e.parser.call(this))},t.reflow=function(){var t=this.ends[y].jQ;Z(t.prev(),1,t.innerHeight()/+t.css("fontSize").slice(0,-2)-.1)}}),T.hat=v($,function(t,e){t.ctrlSeq="\\hat",t.htmlTemplate='<span class="mq-non-leaf"><span class="mq-hat-prefix">^</span><span class="mq-hat-stem">&0</span></span>',t.textTemplate=["hat(",")"]}),ht=T.nthroot=v(ut,function(t,e){t.htmlTemplate='<sup class="mq-nthroot mq-non-leaf">&0</sup><span class="mq-scaled"><span class="mq-sqrt-prefix mq-scaled">&radic;</span><span class="mq-sqrt-stem mq-non-leaf">&1</span></span>',t.textTemplate=["sqrt[","](",")"],t.latex=function(){return"\\sqrt["+this.ends[w].latex()+"]{"+this.ends[y].latex()+"}"}}),pt=v($,function(t,e){t.init=function(t,n,i){var s='<span class="mq-non-leaf"><span class="mq-diacritic-above">'+n+'</span><span class="mq-diacritic-stem">&0</span></span>';e.init.call(this,t,s,i)}}),T.vec=i(pt,"\\vec","&rarr;",["vec(",")"]),T.tilde=i(pt,"\\tilde","~",["tilde(",")"]),ft=v(v($,f),function(e,n){e.init=function(t,e,i,s,r){n.init.call(this,"\\left"+s,m,[e,i]),this.side=t,this.sides={},this.sides[w]={ch:e,ctrlSeq:s},this.sides[y]={ch:i,ctrlSeq:r}},e.numBlocks=function(){return 1},e.html=function(){return this.htmlTemplate='<span class="mq-non-leaf"><span class="mq-scaled mq-paren'+(this.side===y?" mq-ghost":"")+'">'+this.sides[w].ch+'</span><span class="mq-non-leaf">&0</span><span class="mq-scaled mq-paren'+(this.side===w?" mq-ghost":"")+'">'+this.sides[y].ch+"</span></span>",n.html.call(this)},e.latex=function(){return"\\left"+this.sides[w].ctrlSeq+this.ends[w].latex()+"\\right"+this.sides[y].ctrlSeq},e.matchBrack=function(t,e,n){return n instanceof ft&&n.side&&n.side!==-e&&(!t.restrictMismatchedBrackets||dt[this.sides[this.side].ch]===n.sides[n.side].ch||{"(":"]","[":")"}[this.sides[w].ch]===n.sides[y].ch)&&n},e.closeOpposing=function(t){t.side=0,t.sides[this.side]=this.sides[this.side],t.delimjQs.eq(this.side===w?0:1).removeClass("mq-ghost").html(this.sides[this.side].ch)},e.createLeftOf=function(t){var e,i,s;this.replacedFragment||(e=t.options,i="|"===this.sides[w].ch?this.matchBrack(e,y,t[y])||this.matchBrack(e,w,t[w])||this.matchBrack(e,0,t.parent.parent):this.matchBrack(e,-this.side,t[-this.side])||this.matchBrack(e,-this.side,t.parent.parent)),i?(s=this.side=-i.side,this.closeOpposing(i),i===t.parent.parent&&t[s]&&O(t[s],t.parent.ends[s],-s).disown().withDirAdopt(-s,i.parent,i,i[s]).jQ.insDirOf(s,i.jQ),i.bubble("reflow")):(i=this,s=i.side,i.replacedFragment?i.side=0:t[-s]&&(i.replaces(O(t[-s],t.parent.ends[-s],s)),t[-s]=0),n.createLeftOf.call(i,t)),s===w?t.insAtLeftEnd(i.ends[w]):t.insRightOf(i)},e.placeCursor=t,e.unwrap=function(){this.ends[w].children().disown().adopt(this.parent,this,this[y]).jQ.insertAfter(this.jQ),this.remove()},e.deleteSide=function(t,e,n){var i,s,r,o=this.parent,a=this[t],l=o.ends[t];if(t===this.side)return this.unwrap(),void(a?n.insDirOf(-t,a):n.insAtDirEnd(t,o));if(i=n.options,s=!this.side,this.side=-t,this.matchBrack(i,t,this.ends[w].ends[this.side]))this.closeOpposing(this.ends[w].ends[this.side]),r=this.ends[w].ends[t],this.unwrap(),r.siblingCreated&&r.siblingCreated(n.options,t),a?n.insDirOf(-t,a):n.insAtDirEnd(t,o);else{if(this.matchBrack(i,t,this.parent.parent))this.parent.parent.closeOpposing(this),this.parent.parent.unwrap();else{if(e&&s)return this.unwrap(),void(a?n.insDirOf(-t,a):n.insAtDirEnd(t,o));this.sides[t]={ch:dt[this.sides[this.side].ch],ctrlSeq:dt[this.sides[this.side].ctrlSeq]},this.delimjQs.removeClass("mq-ghost").eq(t===w?0:1).addClass("mq-ghost").html(this.sides[t].ch)}a?(r=this.ends[w].ends[t],O(a,l,-t).disown().withDirAdopt(-t,this.ends[w],r,0).jQ.insAtDirEnd(t,this.ends[w].jQ.removeClass("mq-empty")),r.siblingCreated&&r.siblingCreated(n.options,t),n.insDirOf(-t,a)):e?n.insDirOf(t,this):n.insAtDirEnd(t,this.ends[w])}},e.deleteTowards=function(t,e){this.deleteSide(-t,!1,e)},e.finalizeTree=function(){this.ends[w].deleteOutOf=function(t,e){this.parent.deleteSide(t,!0,e)},this.finalizeTree=this.intentionalBlur=function(){this.delimjQs.eq(this.side===w?1:0).removeClass("mq-ghost"),this.side=0}},e.siblingCreated=function(t,e){e===-this.side&&this.finalizeTree()}}),dt={"(":")",")":"(","[":"]","]":"[","{":"}","}":"{","\\{":"\\}","\\}":"\\{","&lang;":"&rang;","&rang;":"&lang;","\\langle ":"\\rangle ","\\rangle ":"\\langle ","|":"|","\\lVert ":"\\rVert ","\\rVert ":"\\lVert ","&#8970;":"&#8971;","\\lfloor ":"\\rfloor ","&#8968;":"&#8969;","\\lceil ":"\\rceil "},d("("),d("["),d("{","\\{"),T.langle=i(ft,w,"&lang;","&rang;","\\langle ","\\rangle "),T.rangle=i(ft,y,"&lang;","&rang;","\\langle ","\\rangle "),j["|"]=i(ft,w,"|","|","|","|"),T.lVert=i(ft,w,"&#8741;","&#8741;","\\lVert ","\\rVert "),T.rVert=i(ft,y,"&#8741;","&#8741;","\\lVert ","\\rVert "),T.lfloor=i(ft,w,"&#8970;","&#8971;","\\lfloor ","\\rfloor "),T.rfloor=i(ft,y,"&#8970;","&#8971;","\\lfloor ","\\rfloor "),T.lceil=i(ft,w,"&#8968;","&#8969;","\\lceil ","\\rceil "),T.rceil=i(ft,y,"&#8968;","&#8969;","\\lceil ","\\rceil "),T.left=v($,function(t){t.parser=function(){var t=z.regex,e=z.string,n=(z.succeed,z.optWhitespace);return n.then(t(/^(?:[([|]|\\\{|\\langle(?![a-zA-Z])|\\lfloor|\\lceil|\\lVert(?![a-zA-Z]))/)).then(function(i){var s="\\"===i.charAt(0)?i.slice(1):i;return"\\langle"==i&&(s="&lang;",i+=" "),"\\lfloor"==i&&(s="&#8970;",i+=" "),"\\lceil"==i&&(s="&#8968;",i+=" "),"\\lVert"==i&&(s="&#8741;",i+=" "),F.then(function(r){return e("\\right").skip(n).then(t(/^(?:[\])|]|\\\}|\\rangle(?![a-zA-Z])|\\rfloor|\\rceil|\\rVert(?![a-zA-Z]))/)).map(function(t){var e,n="\\"===t.charAt(0)?t.slice(1):t;return"\\rangle"==t&&(n="&rang;",t+=" "),"\\rfloor"==t&&(n="&#8971;",t+=" "),"\\rceil"==t&&(n="&#8969;",t+=" "),"\\rVert"==t&&(n="&#8741;",t+=" "),e=ft(0,s,n,i,t),e.blocks=[r],r.adopt(e,0,0),e})})})}}),T.right=v($,function(t){t.parser=function(){return z.fail("unmatched \\right")}}),mt=T.binom=T.binomial=v(v($,f),function(t,e){t.ctrlSeq="\\binom",t.htmlTemplate='<span class="mq-non-leaf"><span class="mq-paren mq-scaled">(</span><span class="mq-non-leaf"><span class="mq-array mq-non-leaf"><span>&0</span><span>&1</span></span></span><span class="mq-paren mq-scaled">)</span></span>',t.textTemplate=["choose(",",",")"]}),T.choose=v(mt,function(t){t.createLeftOf=ct.prototype.createLeftOf}),T.editable=T.MathQuillMathField=v($,function(t,e){t.ctrlSeq="\\MathQuillMathField",t.htmlTemplate='<span class="mq-editable-field"><span class="mq-root-block">&0</span></span>',t.parser=function(){var t=this,n=z.string,i=z.regex,s=z.succeed;return n("[").then(i(/^[a-z][a-z0-9]*/i)).skip(n("]")).map(function(e){t.name=e}).or(s()).then(e.parser.call(t))},t.finalizeTree=function(t){var e=D(this.ends[w],this.jQ,t);e.KIND_OF_MQ="MathField",e.editable=!0,e.createTextarea(),e.editablesTextareaEvents(),e.cursor.insAtRightEnd(e.root),u(e.root)},t.registerInnerField=function(t,e){t.push(t[this.name]=e(this.ends[w].controller))},t.latex=function(){return this.ends[w].latex()},t.text=function(){return this.ends[w].text()}}),T.formula=v($,function(t,e){t.init=function(){e.init.call(this,"\\formula","<span>&0</span>"),this.parameter=[]},t.adopt=function(){var t,n=function(t){var e=function(n){t.parameter.includes(n)||(n.seek=function(){t.seek.apply(t,arguments)},void 0!==n.ends&&0!=n.ends[w]&&e(n.ends[w])),void 0!==n[y]&&0!=n[y]&&e(n[y])};e(t.ends[w])},i=function(t){var e,n,i;for(e=0;e<t.parameter.length;e++)t.parameter[e].owner=t,"\\parameter"==t.parameter[e].parent.ctrlSeq&&t.parameter[e].parent.parent.ends[w]===t.parameter[e].parent&&t.parameter[e].parent.parent.ends[y]===t.parameter[e].parent&&(n=t.parameter[e].parent.parent,n.owner=t.parameter[e].owner,n.i=t.parameter[e].i,i=t.parameter[n.i].parent,t.parameter[n.i]=n,i.patch(n),i.remove())};return this.ends[w].ends[w]===this.ends[y].ends[y]?(t=this.ends[w].ends[w],t[w]=this[w],t[y]=this[y],t[w]&&(t[w][y]=t),t[y]&&(t[y][w]=t),t.parameter=this.parameter,i(t),this.patch(t),n(t),t.adopt.apply(t,arguments)):(i(this),this.patch(this),n(this),e.adopt.apply(this,arguments))},t.patch=function(t){0!=t.parameter.length?(t.fakeends=[],t.fakeends[w]=t.parameter[0],t.fakeends[y]=t.parameter[t.parameter.length-1],t.moveTowards=function(t,e,n){e.insAtDirEnd(-t,this.fakeends[-t])},t.seek=function(){var n=Object.create(t);n.eachChild=function(e){return t.parameter.forEach(e)},e.seek.apply(n,arguments)},t.deleteTowards=function(t,e){e[t]=this.remove()[t]},t.unselectInto=function(t,e){var n,i=null;this.parameter.forEach(function(t){t.id in e.anticursor.ancestors&&(i=t)}),null!=i?(n=e.anticursor.ancestors[i.id],n instanceof q&&(n=n.parent),e.insAtDirEnd(-t,n)):e.insDirOf(-t,this)}):(t.moveTowards=X.prototype.moveTowards,t.deleteTowards=X.prototype.deleteTowards,t.seek=X.prototype.seek)},t.parser=function(){var t=T.parameter.owner;return T.parameter.owner=this,e.parser.apply(this,arguments).map(function(e){return T.parameter.owner=t,e})},t.latex=function(){return this.ends[w].latex()}}),T.parameter=v($,function(t,e){var n=this;t.init=function(){e.init.call(this,"\\parameter","<span>&0</span>")},t.adopt=function(){var t=e.adopt.apply(this,arguments),i=this.ends[w];return i.owner=n.owner,i.i=i.owner.parameter.length,i.owner.parameter.push(i),this.patch(i),t},t.patch=function(t){t.moveOutOf=function(t,e,n){var i=this.i+t;i>=0&&i<this.owner.parameter.length?e.insAtDirEnd(-t,this.owner.parameter[i]):e.insDirOf(t,this.owner)},t.selectOutOf=function(t,e){e.insDirOf(t,this.owner)},t.deleteOutOf=function(t,e){var n=this.i+t;n>=0&&n<this.owner.parameter.length?e.insAtDirEnd(-t,this.owner.parameter[n]):(e.insDirOf(t,this.owner),e[-t]=this.owner.remove()[-t])}},t.latex=function(){return this.ends[w].latex()}}),gt=T.embed=v(X,function(t,e){t.setOptions=function(t){function e(){return""}return this.text=t.text||e,this.htmlTemplate=t.htmlString||"",this.latex=t.latex||e,this},t.parser=function(){var t=this,e=z.string,n=z.regex,i=z.succeed;return e("{").then(n(/^[a-z][a-z0-9]*/i)).skip(e("}")).then(function(s){return e("[").then(n(/^[-\w\s]*/)).skip(e("]")).or(i()).map(function(e){return t.setOptions(L[s](e))})})}}),bt={},T.begin=v($,function(t,e){t.parser=function(){var t=z.string,e=z.regex,n=z.optWhitespace;return n.then(t("{")).then(e(/^[a-z]+/i)).skip(t("}")).then(function(e){return(bt[e]?bt[e]().parser():z.fail("unknown environment type: "+e)).skip(t("\\end").then(n).then(t("{").then(n).then(t(e)).then(n).then(t("}"))))})}}),vt=v($,function(t,e){t.template=[["\\begin{","}"],["\\end{","}"]],t.wrappers=function(){return[t.template[0].join(this.environment),t.template[1].join(this.environment)]}}),wt=bt.matrix=v(vt,function(t,e){var n={column:"&",row:"\\\\"};t.parentheses={left:null,right:null},t.environment="matrix",t.reflow=function(){var t=this.jQ.children("table"),e=t.outerHeight()/+t.css("fontSize").slice(0,-2),n=this.jQ.children(".mq-paren");n.length&&Z(n,Pt(1+.2*(e-1),1.2),1.05*e)},t.latex=function(){var t,e="";return this.eachChild(function(i){void 0!==t&&(e+=t!==i.row?n.row:n.column),t=i.row,e+=i.latex()}),this.wrappers().join(e)},t.html=function(){function t(t){return t?'<span class="mq-scaled mq-paren">'+t+"</span>":""}var n,i=[],s="",r=0;return this.eachChild(function(t){n!==t.row&&(n=t.row,s+="<tr>$tds</tr>",i[n]=[]),i[n].push("<td>&"+r+++"</td>")}),this.htmlTemplate='<span class="mq-matrix mq-non-leaf">'+t(this.parentheses.left)+'<table class="mq-non-leaf">'+s.replace(/\$tds/g,function(){return i.shift().join("")})+"</table>"+t(this.parentheses.right)+"</span>",e.html.call(this)},t.createBlocks=function(){this.blocks=[yt(0,this),yt(0,this),yt(1,this),yt(1,this)]},t.parser=function(){var t=this,e=z.optWhitespace,i=z.string;return e.then(i(n.column).or(i(n.row)).or(F.block)).many().skip(e).then(function(e){function i(){t.blocks.push(yt(o,t,r)),r=[]}var s,r=[],o=0;for(t.blocks=[],s=0;s<e.length;s+=1)e[s]instanceof W?r.push(e[s]):(i(),e[s]===n.row&&(o+=1));return i(),t.autocorrect(),z.succeed(t)})},t.finalizeTree=function(){var t=this.jQ.find("table");t.toggleClass("mq-rows-1",1===t.find("tr").length),this.relink()},t.relink=function(){var t,e,n,i,s=this.blocks,r=[];for(i=0;i<s.length;i+=1)n=s[i],t!==n.row&&(t=n.row,r[t]=[],e=0),r[t][e]=n,n[y]=s[i+1],n[w]=s[i-1],r[t-1]&&r[t-1][e]&&(n.upOutOf=r[t-1][e],r[t-1][e].downOutOf=n),e+=1;this.ends[w]=s[0],this.ends[y]=s[s.length-1]},t.autocorrect=function(t){var e,n,i,s,r,o,a=[];for(t=[],e=this.blocks,o=0;o<e.length;o+=1)r=e[o].row,t[r]=t[r]||[],t[r].push(e[o]),a[r]=t[r].length;if((n=Math.max.apply(null,a))!==Math.min.apply(null,a)){for(o=0;o<t.length;o+=1)for(i=n-t[o].length;i;)s=n*o+t[o].length,e.splice(s,0,yt(o,this)),i-=1;this.relink()}},t.deleteCell=function(t){function e(t){var e,n=[];for(e=0;e<t.length;e+=1)t[e].isEmpty()&&n.push(t[e]);return n.length===t.length}function n(t){for(var e=0;e<t.length;e+=1)c.indexOf(t[e])>-1&&(t[e].remove(),c.splice(c.indexOf(t[e]),1))}var i,s,r=[],o=[],a=[],l=[],c=this.blocks;this.eachChild(function(e){i!==e.row&&(i=e.row,r[i]=[],s=0),o[s]=o[s]||[],o[s].push(e),r[i].push(e),e===t&&(a=r[i],l=o[s]),s+=1}),e(a)&&l.length>1&&(i=r.indexOf(a),this.eachChild(function(t){t.row>i&&(t.row-=1)}),n(a),this.jQ.find("tr").eq(i).remove()),e(l)&&a.length>1&&n(l),this.finalizeTree()},t.addRow=function(t){var e,n,i,s=[],r=[],o=[],a=x("<tr></tr>"),l=t.row,c=0;for(this.eachChild(function(e){e.row<=l&&s.push(e),e.row===l&&(e===t&&(n=c),c+=1),e.row>l&&(e.row+=1,o.push(e))}),i=0;i<c;i+=1)e=yt(l+1),e.parent=this,r.push(e),e.jQ=x('<td class="mq-empty">').attr(Ft,e.id).appendTo(a);return this.jQ.find("tr").eq(l).after(a),this.blocks=s.concat(r,o),r[n]},t.addColumn=function(t){var e,n,i,s=[],r=[];for(this.eachChild(function(n){s[n.row]=s[n.row]||[],s[n.row].push(n),n===t&&(e=s[n.row].length)}),i=0;i<s.length;i+=1)n=yt(i),n.parent=this,r.push(n),s[i].splice(e,0,n),n.jQ=x('<td class="mq-empty">').attr(Ft,n.id);return this.jQ.find("tr").each(function(t){x(this).find("td").eq(e-1).after(s[t][e].jQ)}),this.blocks=[].concat.apply([],s),r[t.row]},t.insert=function(t,e){var n=this[t](e);this.cursor=this.cursor||this.parent.cursor,this.finalizeTree(),this.bubble("reflow").cursor.insAtRightEnd(n)},t.backspace=function(t,e,n,i){var s=t[e];if(t.isEmpty()){for(this.deleteCell(t);s&&s[e]&&-1===this.blocks.indexOf(s);)s=s[e];s&&n.insAtDirEnd(-e,s),1===this.blocks.length&&this.blocks[0].isEmpty()&&(i(),this.finalizeTree()),this.bubble("edited")}}}),bt.pmatrix=v(wt,function(t,e){t.environment="pmatrix",t.parentheses={left:"(",right:")"}}),bt.bmatrix=v(wt,function(t,e){t.environment="bmatrix",t.parentheses={left:"[",right:"]"}}),bt.Bmatrix=v(wt,function(t,e){t.environment="Bmatrix",t.parentheses={left:"{",right:"}"}}),bt.vmatrix=v(wt,function(t,e){t.environment="vmatrix",t.parentheses={left:"|",right:"|"}}),bt.Vmatrix=v(wt,function(t,e){t.environment="Vmatrix",t.parentheses={left:"&#8214;",right:"&#8214;"}}),yt=v(W,function(t,e){t.init=function(t,n,i){if(e.init.call(this),this.row=t,n&&this.adopt(n,n.ends[y],0),i)for(var s=0;s<i.length;s++)i[s].children().adopt(this,this.ends[y],0)},t.keystroke=function(t,n,i){switch(t){case"Shift-Spacebar":return n.preventDefault(),this.parent.insert("addColumn",this);case"Shift-Enter":return this.parent.insert("addRow",this)}return e.keystroke.apply(this,arguments)},t.deleteOutOf=function(t,n){var i=this,s=arguments;this.parent.backspace(this,t,n,function(){return e.deleteOutOf.apply(i,s)})}}),T.notin=T.cong=T.equiv=T.oplus=T.otimes=v(H,function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}}),T["≠"]=T.ne=T.neq=i(H,"\\ne ","&ne;"),T["∗"]=T.ast=T.star=T.loast=T.lowast=i(H,"\\ast ","&lowast;"),T.therefor=T.therefore=i(H,"\\therefore ","&there4;"),T.cuz=T.because=i(H,"\\because ","&#8757;"),T.prop=T.propto=i(H,"\\propto ","&prop;"),T["≈"]=T.asymp=T.approx=i(H,"\\approx ","&asymp;"),T.isin=T.in=i(H,"\\in ","&isin;"),T.ni=T.contains=i(H,"\\ni ","&ni;"),T.notni=T.niton=T.notcontains=T.doesnotcontain=i(H,"\\not\\ni ","&#8716;"),T.sub=T.subset=i(H,"\\subset ","&sub;"),T.sup=T.supset=T.superset=i(H,"\\supset ","&sup;"),T.nsub=T.notsub=T.nsubset=T.notsubset=i(H,"\\not\\subset ","&#8836;"),T.nsup=T.notsup=T.nsupset=T.notsupset=T.nsuperset=T.notsuperset=i(H,"\\not\\supset ","&#8837;"),T.sube=T.subeq=T.subsete=T.subseteq=i(H,"\\subseteq ","&sube;"),T.supe=T.supeq=T.supsete=T.supseteq=T.supersete=T.superseteq=i(H,"\\supseteq ","&supe;"),T.nsube=T.nsubeq=T.notsube=T.notsubeq=T.nsubsete=T.nsubseteq=T.notsubsete=T.notsubseteq=i(H,"\\not\\subseteq ","&#8840;"),T.nsupe=T.nsupeq=T.notsupe=T.notsupeq=T.nsupsete=T.nsupseteq=T.notsupsete=T.notsupseteq=T.nsupersete=T.nsuperseteq=T.notsupersete=T.notsuperseteq=i(H,"\\not\\supseteq ","&#8841;"),T.N=T.naturals=T.Naturals=i(N,"\\mathbb{N}","&#8469;"),T.P=T.primes=T.Primes=T.projective=T.Projective=T.probability=T.Probability=i(N,"\\mathbb{P}","&#8473;"),T.Z=T.integers=T.Integers=i(N,"\\mathbb{Z}","&#8484;"),T.Q=T.rationals=T.Rationals=i(N,"\\mathbb{Q}","&#8474;"),T.R=T.reals=T.Reals=i(N,"\\mathbb{R}","&#8477;"),T.C=T.complex=T.Complex=T.complexes=T.Complexes=T.complexplane=T.Complexplane=T.ComplexPlane=i(N,"\\mathbb{C}","&#8450;"),T.H=T.Hamiltonian=T.quaternions=T.Quaternions=i(N,"\\mathbb{H}","&#8461;"),T.quad=T.emsp=i(N,"\\quad ","    "),T.qquad=i(N,"\\qquad ","        "),T.diamond=i(N,"\\diamond ","&#9671;"),T.bigtriangleup=i(N,"\\bigtriangleup ","&#9651;"),T.ominus=i(N,"\\ominus ","&#8854;"),T.uplus=i(N,"\\uplus ","&#8846;"),T.bigtriangledown=i(N,"\\bigtriangledown ","&#9661;"),T.sqcap=i(N,"\\sqcap ","&#8851;"),T.triangleleft=i(N,"\\triangleleft ","&#8882;"),T.sqcup=i(N,"\\sqcup ","&#8852;"),T.triangleright=i(N,"\\triangleright ","&#8883;"),T.odot=T.circledot=i(N,"\\odot ","&#8857;"),T.bigcirc=i(N,"\\bigcirc ","&#9711;"),T.dagger=i(N,"\\dagger ","&#0134;"),T.ddagger=i(N,"\\ddagger ","&#135;"),T.wr=i(N,"\\wr ","&#8768;"),T.amalg=i(N,"\\amalg ","&#8720;"),T.models=i(N,"\\models ","&#8872;"),T.prec=i(N,"\\prec ","&#8826;"),T.succ=i(N,"\\succ ","&#8827;"),T.preceq=i(N,"\\preceq ","&#8828;"),T.succeq=i(N,"\\succeq ","&#8829;"),T.simeq=i(N,"\\simeq ","&#8771;"),T.mid=i(N,"\\mid ","&#8739;"),T.ll=i(N,"\\ll ","&#8810;"),T.gg=i(N,"\\gg ","&#8811;"),T.parallel=i(N,"\\parallel ","&#8741;"),T.nparallel=i(N,"\\nparallel ","&#8742;"),T.bowtie=i(N,"\\bowtie ","&#8904;"),T.sqsubset=i(N,"\\sqsubset ","&#8847;"),T.sqsupset=i(N,"\\sqsupset ","&#8848;"),T.smile=i(N,"\\smile ","&#8995;"),T.sqsubseteq=i(N,"\\sqsubseteq ","&#8849;"),T.sqsupseteq=i(N,"\\sqsupseteq ","&#8850;"),T.doteq=i(N,"\\doteq ","&#8784;"),T.frown=i(N,"\\frown ","&#8994;"),T.vdash=i(N,"\\vdash ","&#8870;"),T.dashv=i(N,"\\dashv ","&#8867;"),T.nless=i(N,"\\nless ","&#8814;"),T.ngtr=i(N,"\\ngtr ","&#8815;"),T.longleftarrow=i(N,"\\longleftarrow ","&xlarr;"),T.longrightarrow=i(N,"\\longrightarrow ","&xrarr;"),T.Longleftarrow=i(N,"\\Longleftarrow ","&xlArr;"),T.Longrightarrow=i(N,"\\Longrightarrow ","&xrArr;"),T.longleftrightarrow=i(N,"\\longleftrightarrow ","&xharr;"),T.updownarrow=i(N,"\\updownarrow ","&#8597;"),T.Longleftrightarrow=i(N,"\\Longleftrightarrow ","&xhArr;"),T.Updownarrow=i(N,"\\Updownarrow ","&#8661;"),T.mapsto=i(N,"\\mapsto ","&#8614;"),T.nearrow=i(N,"\\nearrow ","&#8599;"),T.hookleftarrow=i(N,"\\hookleftarrow ","&#8617;"),T.hookrightarrow=i(N,"\\hookrightarrow ","&#8618;"),T.searrow=i(N,"\\searrow ","&#8600;"),T.leftharpoonup=i(N,"\\leftharpoonup ","&#8636;"),T.rightharpoonup=i(N,"\\rightharpoonup ","&#8640;"),T.swarrow=i(N,"\\swarrow ","&#8601;"),T.leftharpoondown=i(N,"\\leftharpoondown ","&#8637;"),T.rightharpoondown=i(N,"\\rightharpoondown ","&#8641;"),T.nwarrow=i(N,"\\nwarrow ","&#8598;"),T.ldots=i(N,"\\ldots ","&#8230;"),T.cdots=i(N,"\\cdots ","&#8943;"),T.vdots=i(N,"\\vdots ","&#8942;"),T.ddots=i(N,"\\ddots ","&#8945;"),T.surd=i(N,"\\surd ","&#8730;"),T.triangle=i(N,"\\triangle ","&#9651;"),T.ell=i(N,"\\ell ","&#8467;"),T.top=i(N,"\\top ","&#8868;"),T.flat=i(N,"\\flat ","&#9837;"),T.natural=i(N,"\\natural ","&#9838;"),T.sharp=i(N,"\\sharp ","&#9839;"),T.wp=i(N,"\\wp ","&#8472;"),T.bot=i(N,"\\bot ","&#8869;"),T.clubsuit=i(N,"\\clubsuit ","&#9827;"),T.diamondsuit=i(N,"\\diamondsuit ","&#9826;"),T.heartsuit=i(N,"\\heartsuit ","&#9825;"),T.spadesuit=i(N,"\\spadesuit ","&#9824;"),T.parallelogram=i(N,"\\parallelogram ","&#9649;"),T.square=i(N,"\\square ","&#11036;"),T.oint=i(N,"\\oint ","&#8750;"),T.bigcap=i(N,"\\bigcap ","&#8745;"),T.bigcup=i(N,"\\bigcup ","&#8746;"),T.bigsqcup=i(N,"\\bigsqcup ","&#8852;"),T.bigvee=i(N,"\\bigvee ","&#8744;"),T.bigwedge=i(N,"\\bigwedge ","&#8743;"),T.bigodot=i(N,"\\bigodot ","&#8857;"),T.bigotimes=i(N,"\\bigotimes ","&#8855;"),T.bigoplus=i(N,"\\bigoplus ","&#8853;"),T.biguplus=i(N,"\\biguplus ","&#8846;"),T.opencurlybrace=T.lbrace=i(N,"\\lbrace ","{"),T.closecurlybrace=T.rbrace=i(N,"\\rbrace ","}"),T.lbrack=i(N,"["),T.rbrack=i(N,"]"),T.slash=i(N,"/"),T.vert=i(N,"|"),T.perp=T.perpendicular=i(N,"\\perp ","&perp;"),T.nabla=T.del=i(N,"\\nabla ","&nabla;"),T.hbar=i(N,"\\hbar ","&#8463;"),T.AA=T.Angstrom=T.angstrom=i(N,"\\text\\AA ","&#8491;"),T.ring=T.circ=T.circle=i(N,"\\circ ","&#8728;"),T.bull=T.bullet=i(N,"\\bullet ","&bull;"),T.setminus=T.smallsetminus=i(N,"\\setminus ","&#8726;"),T.not=T["¬"]=T.neg=i(N,"\\neg ","&not;"),T["…"]=T.dots=T.ellip=T.hellip=T.ellipsis=T.hellipsis=i(N,"\\dots ","&hellip;"),T.converges=T.darr=T.dnarr=T.dnarrow=T.downarrow=i(N,"\\downarrow ","&darr;"),T.dArr=T.dnArr=T.dnArrow=T.Downarrow=i(N,"\\Downarrow ","&dArr;"),T.diverges=T.uarr=T.uparrow=i(N,"\\uparrow ","&uarr;"),T.uArr=T.Uparrow=i(N,"\\Uparrow ","&uArr;"),T.to=i(H,"\\to ","&rarr;"),T.rarr=T.rightarrow=i(N,"\\rightarrow ","&rarr;"),T.implies=i(H,"\\Rightarrow ","&rArr;"),T.rArr=T.Rightarrow=i(N,"\\Rightarrow ","&rArr;");T.gets=i(H,"\\gets ","&larr;"),T.larr=T.leftarrow=i(N,"\\leftarrow ","&larr;"),T.impliedby=i(H,"\\Leftarrow ","&lArr;"),T.lArr=T.Leftarrow=i(N,"\\Leftarrow ","&lArr;"),T.harr=T.lrarr=T.leftrightarrow=i(N,"\\leftrightarrow ","&harr;"),T.iff=i(H,"\\Leftrightarrow ","&hArr;"),T.hArr=T.lrArr=T.Leftrightarrow=i(N,"\\Leftrightarrow ","&hArr;"),T.Re=T.Real=T.real=i(N,"\\Re ","&real;"),T.Im=T.imag=T.image=T.imagin=T.imaginary=T.Imaginary=i(N,"\\Im ","&image;"),T.part=T.partial=i(N,"\\partial ","&part;"),T.infty=T.infin=T.infinity=i(N,"\\infty ","&infin;"),T.pounds=i(N,"\\pounds ","&pound;"),T.alef=T.alefsym=T.aleph=T.alephsym=i(N,"\\aleph ","&alefsym;"),T.xist=T.xists=T.exist=T.exists=i(N,"\\exists ","&exist;"),T.nexists=T.nexist=i(N,"\\nexists ","&#8708;"),T.and=T.land=T.wedge=i(H,"\\wedge ","&and;"),T.or=T.lor=T.vee=i(H,"\\vee ","&or;"),T.o=T.O=T.empty=T.emptyset=T.oslash=T.Oslash=T.nothing=T.varnothing=i(H,"\\varnothing ","&empty;"),T.cup=T.union=i(H,"\\cup ","&cup;"),T.cap=T.intersect=T.intersection=i(H,"\\cap ","&cap;"),T.deg=T.degree=i(N,"\\degree ","&deg;"),T.ang=T.angle=i(N,"\\angle ","&ang;"),T.measuredangle=i(N,"\\measuredangle ","&#8737;"),xt=v(N,function(t,e){t.createLeftOf=function(t){t.options.autoSubscriptNumerals&&t.parent!==t.parent.parent.sub&&(t[w]instanceof qt&&!1!==t[w].isItalic||t[w]instanceof ot&&t[w][w]instanceof qt&&!1!==t[w][w].isItalic)?(T._().createLeftOf(t),e.createLeftOf.call(this,t),t.insRightOf(t.parent.parent)):e.createLeftOf.call(this,t)}}),qt=v(X,function(t,e){t.init=function(t,n){e.init.call(this,t,"<var>"+(n||t)+"</var>")},t.text=function(){var t=this.ctrlSeq;return this.isPartOfOperator?"\\"==t[0]?t=t.slice(1,t.length):" "==t[t.length-1]&&(t=t.slice(0,-1)):(!this[w]||this[w]instanceof qt||this[w]instanceof H||"\\ "===this[w].ctrlSeq||(t="*"+t),!this[y]||this[y]instanceof H||this[y]instanceof ot||(t+="*")),t}}),_.p.autoCommands={_maxLength:0},E.autoCommands=function(t){var e,n,i,s,r;if(!/^[a-z]+(?: [a-z]+)*$/i.test(t))throw'"'+t+'" not a space-delimited list of only letters';for(e=t.split(" "),n={},i=0,s=0;s<e.length;s+=1){if(r=e[s],r.length<2)throw'autocommand "'+r+'" not minimum length of 2';if(T[r]===Ct)throw'"'+r+'" is a built-in operator name';n[r]=1,i=$t(i,r.length)}return n._maxLength=i,n},kt=v(qt,function(t,e){function n(t){return!t||t instanceof H||t instanceof at}t.init=function(t){return e.init.call(this,this.letter=t)},t.createLeftOf=function(t){var n,i,s,r,o;if(e.createLeftOf.apply(this,arguments),n=t.options.autoCommands,i=n._maxLength,i>0){for(s="",r=this,o=0;r instanceof kt&&r.ctrlSeq===r.letter&&o<i;)s=r.letter+s,r=r[w],o+=1;for(;s.length;){if(n.hasOwnProperty(s)){for(o=1,r=this;o<s.length;o+=1,r=r[w]);return O(r,this).remove(),t[w]=r[w],T[s](s).createLeftOf(t)}s=s.slice(1)}}},t.italicize=function(t){return this.isItalic=t,this.isPartOfOperator=!t,this.jQ.toggleClass("mq-operator-name",!t),this},t.finalizeTree=t.siblingDeleted=t.siblingCreated=function(t,e){e!==w&&this[y]instanceof kt||this.autoUnItalicize(t)},t.autoUnItalicize=function(t){var e,i,s,r,o,a,l,c,u,h,p,f,d=t.autoOperatorNames;if(0!==d._maxLength){for(e=this.letter,i=this[w];i instanceof kt;i=i[w])e=i.letter+e;for(s=this[y];s instanceof kt;s=s[y])e+=s.letter;O(i[y]||this.parent.ends[w],s[w]||this.parent.ends[y]).each(function(t){t.italicize(!0).jQ.removeClass("mq-first mq-last mq-followed-by-supsub"),t.ctrlSeq=t.letter});t:for(r=0,o=i[y]||this.parent.ends[w];r<e.length;r+=1,o=o[y])for(a=Pt(d._maxLength,e.length-r);a>0;a-=1)if(l=e.slice(r,r+a),d.hasOwnProperty(l)){for(c=0,u=o;c<a;c+=1,u=u[y])u.italicize(!1),h=u;p=Ot.hasOwnProperty(l),o.ctrlSeq=(p?"\\":"\\operatorname{")+o.ctrlSeq,h.ctrlSeq+=p?" ":"}",jt.hasOwnProperty(l)&&h[w][w][w].jQ.addClass("mq-last"),n(o[w])||o.jQ.addClass("mq-first"),n(h[y])||(h[y]instanceof ot?(f=h[y],(f.siblingCreated=f.siblingDeleted=function(){f.jQ.toggleClass("mq-after-operator-name",!(f[y]instanceof ft))})()):h.jQ.toggleClass("mq-last",!(h[y]instanceof ft))),r+=a-1,o=h;continue t}}}}),Ot={},Tt=_.p.autoOperatorNames={_maxLength:9},jt={limsup:1,liminf:1,projlim:1,injlim:1},function(){var t,e,n,i,s="arg deg det dim exp gcd hom inf ker lg lim ln log max min sup limsup liminf injlim projlim Pr".split(" ");for(t=0;t<s.length;t+=1)Ot[s[t]]=Tt[s[t]]=1;for(e="sin cos tan arcsin arccos arctan sinh cosh tanh sec csc cot coth".split(" "),t=0;t<e.length;t+=1)Ot[e[t]]=1;for(n="sin cos tan sec cosec csc cotan cot ctg".split(" "),t=0;t<n.length;t+=1)Tt[n[t]]=Tt["arc"+n[t]]=Tt[n[t]+"h"]=Tt["ar"+n[t]+"h"]=Tt["arc"+n[t]+"h"]=1;for(i="gcf hcf lcm proj span".split(" "),t=0;t<i.length;t+=1)Tt[i[t]]=1}(),E.autoOperatorNames=function(t){var e,n,i,s,r;if(!/^[a-z]+(?: [a-z]+)*$/i.test(t))throw'"'+t+'" not a space-delimited list of only letters';for(e=t.split(" "),n={},i=0,s=0;s<e.length;s+=1){if(r=e[s],r.length<2)throw'"'+r+'" not minimum length of 2';n[r]=1,i=$t(i,r.length)}return n._maxLength=i,n},Ct=v(X,function(t,e){t.init=function(t){this.ctrlSeq=t},t.createLeftOf=function(t){var e,n=this.ctrlSeq;for(e=0;e<n.length;e+=1)kt(n.charAt(e)).createLeftOf(t)},t.parser=function(){var t,e=this.ctrlSeq,n=W();for(t=0;t<e.length;t+=1)kt(e.charAt(t)).adopt(n,n.ends[y],0);return z.succeed(n.children())}});for(Qt in Tt)Tt.hasOwnProperty(Qt)&&(T[Qt]=Ct);T.operatorname=v($,function(e){e.createLeftOf=t,e.numBlocks=function(){return 1},e.parser=function(){return F.block.map(function(t){return t.children()})}}),T.f=v(kt,function(t,e){t.init=function(){X.p.init.call(this,this.letter="f",'<var class="mq-f">f</var>')},t.italicize=function(t){return this.jQ.html("f").toggleClass("mq-f",t),e.italicize.apply(this,arguments)}}),T[" "]=T.space=i(N,"\\ ","&nbsp;"),T["'"]=T.prime=i(N,"'","&prime;"),T["″"]=T.dprime=i(N,"″","&Prime;"),T.backslash=i(N,"\\backslash ","\\"),j["\\"]||(j["\\"]=T.backslash),T.$=i(N,"\\$","$"),Dt=v(X,function(t,e){t.init=function(t,n){e.init.call(this,t,'<span class="mq-nonSymbola">'+(n||t)+"</span>")}}),T["@"]=Dt,T["&"]=i(Dt,"\\&","&amp;"),T["%"]=i(Dt,"\\%","%"),T.alpha=T.beta=T.gamma=T.delta=T.zeta=T.eta=T.theta=T.iota=T.kappa=T.mu=T.nu=T.xi=T.rho=T.sigma=T.tau=T.chi=T.psi=T.omega=v(qt,function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}}),T.phi=i(qt,"\\phi ","&#981;"),T.phiv=T.varphi=i(qt,"\\varphi ","&phi;"),T.epsilon=i(qt,"\\epsilon ","&#1013;"),T.epsiv=T.varepsilon=i(qt,"\\varepsilon ","&epsilon;"),T.piv=T.varpi=i(qt,"\\varpi ","&piv;"),T.sigmaf=T.sigmav=T.varsigma=i(qt,"\\varsigma ","&sigmaf;"),T.thetav=T.vartheta=T.thetasym=i(qt,"\\vartheta ","&thetasym;"),T.upsilon=T.upsi=i(qt,"\\upsilon ","&upsilon;"),T.gammad=T.Gammad=T.digamma=i(qt,"\\digamma ","&#989;"),T.kappav=T.varkappa=i(qt,"\\varkappa ","&#1008;"),T.rhov=T.varrho=i(qt,"\\varrho ","&#1009;"),T.pi=T["π"]=i(Dt,"\\pi ","&pi;"),T.lambda=i(Dt,"\\lambda ","&lambda;"),T.Upsilon=T.Upsi=T.upsih=T.Upsih=i(X,"\\Upsilon ",'<var style="font-family: serif">&upsih;</var>'),T.Gamma=T.Delta=T.Theta=T.Lambda=T.Xi=T.Pi=T.Sigma=T.Phi=T.Psi=T.Omega=T.forall=v(N,function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}}),St=v($,function(t){t.init=function(t){this.latex=t},t.createLeftOf=function(t){var e=F.parse(this.latex);e.children().adopt(t.parent,t[w],t[y]),t[w]=e.ends[y],e.jQize().insertBefore(t.jQ),e.finalizeInsert(t.options,t),e.ends[y][y].siblingCreated&&e.ends[y][y].siblingCreated(t.options,w),e.ends[w][w].siblingCreated&&e.ends[w][w].siblingCreated(t.options,y),t.parent.bubble("reflow")},t.parser=function(){var t=F.parse(this.latex).children();return z.succeed(t)}}),T["¹"]=i(St,"^1"),T["²"]=i(St,"^2"),T["³"]=i(St,"^3"),T["¼"]=i(St,"\\frac14"),T["½"]=i(St,"\\frac12"),T["¾"]=i(St,"\\frac34"),_t=v(H,function(t){t.init=N.prototype.init,t.contactWeld=t.siblingCreated=t.siblingDeleted=function(t,e){function n(t){return t[w]?t[w]instanceof H||/^[,;:\(\[]$/.test(t[w].ctrlSeq)?"":"mq-binary-operator":t.parent&&t.parent.parent&&t.parent.parent.isStyleBlock()?n(t.parent.parent):""}if(e!==y)return this.jQ[0].className=n(this),this}}),T["+"]=i(_t,"+","+"),T["–"]=T["-"]=i(_t,"-","&minus;"),T["±"]=T.pm=T.plusmn=T.plusminus=i(_t,"\\pm ","&plusmn;"),T.mp=T.mnplus=T.minusplus=i(_t,"\\mp ","&#8723;"),j["*"]=T.sdot=T.cdot=i(H,"\\cdot ","&middot;","*"),Et=v(H,function(t,e){t.init=function(t,n){this.data=t,this.strict=n;var i=n?"Strict":""
;e.init.call(this,t["ctrlSeq"+i],t["html"+i],t["text"+i])},t.swap=function(t){this.strict=t;var e=t?"Strict":"";this.ctrlSeq=this.data["ctrlSeq"+e],this.jQ.html(this.data["html"+e]),this.textTemplate=[this.data["text"+e]]},t.deleteTowards=function(t,n){if(t===w&&!this.strict)return this.swap(!0),void this.bubble("reflow");e.deleteTowards.apply(this,arguments)}}),At={ctrlSeq:"\\le ",html:"&le;",text:"≤",ctrlSeqStrict:"<",htmlStrict:"&lt;",textStrict:"<"},Lt={ctrlSeq:"\\ge ",html:"&ge;",text:"≥",ctrlSeqStrict:">",htmlStrict:"&gt;",textStrict:">"},T["<"]=T.lt=i(Et,At,!0),T[">"]=T.gt=i(Et,Lt,!0),T["≤"]=T.le=T.leq=i(Et,At,!1),T["≥"]=T.ge=T.geq=i(Et,Lt,!1),Rt=v(H,function(t,e){t.init=function(){e.init.call(this,"=","=")},t.createLeftOf=function(t){if(t[w]instanceof Et&&t[w].strict)return t[w].swap(!1),void t[w].bubble("reflow");e.createLeftOf.apply(this,arguments)}}),T["="]=Rt,T["×"]=T.times=i(H,"\\times ","&times;","[x]"),T["÷"]=T.div=T.divide=T.divides=i(H,"\\div ","&divide;","[/]"),j["~"]=T.sim=i(H,"\\sim ","~","~"),Bt=c(1);for(It in Bt)!function(t,e){"function"==typeof e?(l[t]=function(){return a(),e.apply(this,arguments)},l[t].prototype=e.prototype):l[t]=e}(It,Bt[It])}();
